{"title":"Mysql数据库学习笔记","slug":"Mysql数据库学习笔记","date":"2023-10-12T08:58:32.000Z","updated":"2024-08-15T09:20:07.639Z","comments":true,"path":"api/articles/Mysql数据库学习笔记.json","realPath":null,"excerpt":null,"covers":null,"cover":null,"content":"<hr>\n<h1 id=\"一、名词介绍\"><a href=\"#一、名词介绍\" class=\"headerlink\" title=\"一、名词介绍\"></a>一、名词介绍</h1><p>1、<code>DML</code>：数据操作语言，用来对数据库中的数据进行增删改操作，包含以下三个指令：<code>insert</code>、<code>delete</code>、<code>update</code>。<br>2、<code>DDL</code>：数据定义语言，用来定义数据库对象：数据库、数据表、视图、索引等，包含以下三个指令：<code>create</code>、<code>drop</code>、<code>alter</code>。<br>3、<code>DCL</code>：数据控制语言，用来定义数据库的访问权限和安全级别，以及创建用户，授予或回收权限等，包含以下三个指令：<code>grant</code>、<code>revoke</code>、<code>commit</code>。<br>4、<code>DQL</code>：数据查询语言，用来查询数据库中表的记录，使用最多，包含以下三个指令：<code>select</code>、<code>distinct</code>、<code>where</code>。<br>5、事务隔离级别<br>（1）说明：数据库事务的隔离级别是指在多个事务并发执行时，数据库系统为了保证数据一致性所遵循的规定。<br>（2）读未提交（Read Uncommitied）：事务可以读取未被提交的数据，容易产生脏读（一个事务读取了另一个事务未提交的数据，是真正的错误）、不可重复读（一个事务读取了另一个事务提交的修改数据）和幻读（一个事务读取了另一个事务提交的插入数据）等问题。<br>（3）读已提交（Read Commitied）：事务只能读取已经提交的数据，可以避免脏读问题，但可能引发不可重复读和幻读。<br>（4）可重复度（Repeatable Read）：在一个事务中，相同的查询将返回相同的结果集，不管其他事务对数据做了什么修改，可以避免脏读和不可重复读，但仍有幻读的问题。（Mysql默认使用级别）<br>（5）串行化（Serializable）：最高的隔离级别，完全禁止了并发，只允许一个事务执行完毕之后才能执行另一个事务，可以避免以上所有问题，但效率较低，不适用于高并发场景。  </p>\n<br/>\n\n\n<hr>\n<br/>\n\n\n\n<h1 id=\"二、Mysql操作命令\"><a href=\"#二、Mysql操作命令\" class=\"headerlink\" title=\"二、Mysql操作命令\"></a>二、Mysql操作命令</h1><h3 id=\"1、连接mysql\"><a href=\"#1、连接mysql\" class=\"headerlink\" title=\"1、连接mysql\"></a>1、连接mysql</h3><p>在Dos（cmd）命令中执行：<code>mysql -u 【mysql用户名】 -p</code>，然后输入密码，比如：<code>mysql -u root -p root</code>。</p>\n<h3 id=\"2、查看数据库\"><a href=\"#2、查看数据库\" class=\"headerlink\" title=\"2、查看数据库\"></a>2、查看数据库</h3><p>连接mysql之后，执行命令：<code>show databases;</code>（别忘记分号），查看数据库有几个。</p>\n<h3 id=\"3、选择要使用哪个数据库\"><a href=\"#3、选择要使用哪个数据库\" class=\"headerlink\" title=\"3、选择要使用哪个数据库\"></a>3、选择要使用哪个数据库</h3><p><code>use test;</code>：选择使用test数据库。</p>\n<h3 id=\"4、查看数据库里有几个表\"><a href=\"#4、查看数据库里有几个表\" class=\"headerlink\" title=\"4、查看数据库里有几个表\"></a>4、查看数据库里有几个表</h3><p><code>show tables;</code>：查看tables数据库有几个表。</p>\n<h3 id=\"5、创建表\"><a href=\"#5、创建表\" class=\"headerlink\" title=\"5、创建表\"></a>5、创建表</h3><p>在mysql命令行输入：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> student(</span><br><span class=\"line\"><span class=\"operator\">-</span><span class=\"operator\">&gt;</span>id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment comment <span class=\"string\">&#x27;注释&#x27;</span>,</span><br><span class=\"line\"><span class=\"operator\">-</span><span class=\"operator\">&gt;</span>name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>),</span><br><span class=\"line\"><span class=\"operator\">-</span><span class=\"operator\">&gt;</span>sex <span class=\"type\">char</span>(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、查看表结构\"><a href=\"#6、查看表结构\" class=\"headerlink\" title=\"6、查看表结构\"></a>6、查看表结构</h3><p><code>desc student;</code>：查看student表结构。</p>\n<h3 id=\"7、设置中文乱码问题\"><a href=\"#7、设置中文乱码问题\" class=\"headerlink\" title=\"7、设置中文乱码问题\"></a>7、设置中文乱码问题</h3><p>1、查看编码<br><code>show variables like &#39;char%&#39;;</code><br>2、更改编码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> character_set_results<span class=\"operator\">=</span>gbk; #结果显示乱码问题</span><br><span class=\"line\"><span class=\"keyword\">set</span> character_set_client<span class=\"operator\">=</span>gbk; #数据写入报错</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、插入多个数据\"><a href=\"#8、插入多个数据\" class=\"headerlink\" title=\"8、插入多个数据\"></a>8、插入多个数据</h3><p><code>insert into student(name,sex) values (&#39;张三&#39;,&#39;男&#39;),(&#39;李四&#39;,&#39;女&#39;);</code></p>\n<h3 id=\"9、删除数据\"><a href=\"#9、删除数据\" class=\"headerlink\" title=\"9、删除数据\"></a>9、删除数据</h3><p><code>delete from student where name = &#39;张三&#39;;</code></p>\n<h3 id=\"10、更改数据\"><a href=\"#10、更改数据\" class=\"headerlink\" title=\"10、更改数据\"></a>10、更改数据</h3><p><code>update student set name=&#39;张三&#39; where name=&#39;李四&#39;;</code>：把李四改成张三。</p>\n<h3 id=\"11、删除表\"><a href=\"#11、删除表\" class=\"headerlink\" title=\"11、删除表\"></a>11、删除表</h3><p><code>drop table student;</code></p>\n<h3 id=\"12、表中新增一列属性\"><a href=\"#12、表中新增一列属性\" class=\"headerlink\" title=\"12、表中新增一列属性\"></a>12、表中新增一列属性</h3><p>语法：<code>alter table 【表名】 add 【列名】 【列类型】;</code><br>例子：<code>alter table table_name add col_name char(5);</code>（向table_name表新增一列col_name属性，类型为char）<br>如果我们希望添加在指定的一列，可以用：<br><code>alter table table_name add column_name varchar(255) not null after name;</code><br>注意，上面这个命令的意思是说添加新列到某一列后面。如果想添加到第一列的话，可以用：<br><code>alter table table_name add column column_name varchar(255) not null first;</code></p>\n<h3 id=\"13、添加外键\"><a href=\"#13、添加外键\" class=\"headerlink\" title=\"13、添加外键\"></a>13、添加外键</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 从表名 <span class=\"operator\">/</span><span class=\"operator\">/</span>student</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span>   <span class=\"keyword\">ADD</span> <span class=\"keyword\">CONSTRAINT</span> (main_id_con)<span class=\"operator\">/</span><span class=\"operator\">/</span>外键 student里的tid</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span>   <span class=\"keyword\">FOREIGN</span> KEY (main_id)<span class=\"operator\">/</span><span class=\"operator\">/</span>从表外键字段(tid)</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span>   <span class=\"keyword\">REFERENCES</span>  主表(id); <span class=\"operator\">/</span><span class=\"operator\">/</span>teacher</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"14、多表查询\"><a href=\"#14、多表查询\" class=\"headerlink\" title=\"14、多表查询\"></a>14、多表查询</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\"><span class=\"keyword\">distinct</span> t1.AGENT_ZONE <span class=\"keyword\">as</span> agentzone,   #<span class=\"keyword\">distinct</span> : 去重</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> t1.G_CORP_NAME) <span class=\"keyword\">as</span> unitcount,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> t1.BATCHNO) <span class=\"keyword\">as</span> batchno,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GBA_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> bpnums,  </span><br><span class=\"line\">#<span class=\"keyword\">case</span> <span class=\"keyword\">when</span>:当t1.GAB_BANK_F为<span class=\"number\">2</span>的时候等于<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> bcount,</span><br><span class=\"line\">#<span class=\"keyword\">case</span> <span class=\"keyword\">when</span>:当t1.GAB_BANK_F为<span class=\"number\">2</span>的时候等于G_AMOUNT 的值</span><br><span class=\"line\"><span class=\"built_in\">sum</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"keyword\">then</span> t1.G_AMOUNT <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> bamount,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GBA_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> tpnums,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> tcount,</span><br><span class=\"line\"><span class=\"built_in\">sum</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">then</span> t1.G_AMOUNT <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> tamount</span><br><span class=\"line\"><span class=\"keyword\">from</span> GJT_WAGES_DETAIL t1</span><br><span class=\"line\"># <span class=\"keyword\">left</span> join...on ：连接查询，即使右表中没有匹配，也从左表返回所有的行</span><br><span class=\"line\"><span class=\"keyword\">left</span> <span class=\"keyword\">join</span> GJT_WAGES_SUMMARY t2 </span><br><span class=\"line\"><span class=\"keyword\">on</span> t1.BATCHNO <span class=\"operator\">=</span> t2.BATCHNO</span><br><span class=\"line\"><span class=\"keyword\">where</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> WORKDATE <span class=\"keyword\">between</span> <span class=\"string\">&#x27;2020-04-11&#x27;</span> <span class=\"keyword\">and</span> <span class=\"string\">&#x27;2021-09-12&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> t1.AGENT_ZONE # 以t1.AGENT_ZONE分组  ，分组后如果还要使用<span class=\"keyword\">where</span>条件，就用<span class=\"keyword\">having</span>代替<span class=\"keyword\">where</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"15、修改某一列的字段属性\"><a href=\"#15、修改某一列的字段属性\" class=\"headerlink\" title=\"15、修改某一列的字段属性\"></a>15、修改某一列的字段属性</h3><p><code>alter table user modify column sex varchar(50);</code></p>\n<h3 id=\"16、创建一个新表和某一旧表一样\"><a href=\"#16、创建一个新表和某一旧表一样\" class=\"headerlink\" title=\"16、创建一个新表和某一旧表一样\"></a>16、创建一个新表和某一旧表一样</h3><p><code>create table 【新表名】 like 【旧表名】;</code></p>\n<h3 id=\"17、修改某一列的列名\"><a href=\"#17、修改某一列的列名\" class=\"headerlink\" title=\"17、修改某一列的列名\"></a>17、修改某一列的列名</h3><p><code>alter table 【表名】 change 【旧列名】 【新列名】 【新列名类型】;</code></p>\n<h3 id=\"18、删除某一列\"><a href=\"#18、删除某一列\" class=\"headerlink\" title=\"18、删除某一列\"></a>18、删除某一列</h3><p><code>alter table 【表名】 drop 【列名】;</code></p>\n<h3 id=\"19、修改表名\"><a href=\"#19、修改表名\" class=\"headerlink\" title=\"19、修改表名\"></a>19、修改表名</h3><p><code>rename table 【旧表名】 to 【新表名】;</code></p>\n<h3 id=\"20、蠕虫复制\"><a href=\"#20、蠕虫复制\" class=\"headerlink\" title=\"20、蠕虫复制\"></a>20、蠕虫复制</h3><p><code>insert into 【新表】 select * from 【旧表】;</code><br>如果只想复制某几个字段：<br><code>insert into 【新表】(name,sex) select (name,sex) from 【旧表】;</code></p>\n<h3 id=\"21、单个升序、降序查询\"><a href=\"#21、单个升序、降序查询\" class=\"headerlink\" title=\"21、单个升序、降序查询\"></a>21、单个升序、降序查询</h3><p><code>select * from 【表名】 where 【查询条件】 order by 【根据什么字段】 【ASC/DESC】;</code>(ASC：升序。DESC：降序)</p>\n<h3 id=\"22、多个字段升序、降序查询\"><a href=\"#22、多个字段升序、降序查询\" class=\"headerlink\" title=\"22、多个字段升序、降序查询\"></a>22、多个字段升序、降序查询</h3><p><code>select * from 【表名】 where 【查询条件】 order by 【字段1】 【ASC/DESC】,【字段2】 【ASC/DESC】;</code>（ASC：升序。DESC：降序）<br>（1）想要将null值的数据往后就：（默认）<br><code>select * from 【表名】 where 【查询条件】 order by 【字段】 【ASC/DESC】 nulls last;</code><br>（2）想要将null值的数据往前排就：<br><code>select * from 【表名】 where 【查询条件】 order by 【字段】 【ASC/DESC】 nulls first;</code></p>\n<h3 id=\"23、分页\"><a href=\"#23、分页\" class=\"headerlink\" title=\"23、分页\"></a>23、分页</h3><p><code>limit</code>：跳过几条，当前页显示几条。<br>例如：<br>（1）<code>limit 0,5</code>：跳过0条，从第1条数据开始，显示5条，当前页面显示5条，相当于第一页，查找了5条；<br>（2）<code>limit 5,5</code>：跳过5条，从第6条数据开始，显示5条，当前页面显示5条，相当于第二页，查找了5条；<br>（3）<code>limit 2,5</code>：跳过2条，从第3条数据开始，显示5条，查找出第3、4、5、6、7五条数据显示在当前页面。</p>\n<h3 id=\"24、连接查询\"><a href=\"#24、连接查询\" class=\"headerlink\" title=\"24、连接查询\"></a>24、连接查询</h3><p>1、<code>left join...on...</code>：表1左连接表2，以左为主，表示以表1为主，关联上表2的数据；<br>2、<code>right join...on...</code>：右连接查询，和左连接查询相反；<br>3、<code>inner join...on...</code>：内连接查询，表示以两个表的交集为主，查询出来的数据是两个表交集的部分，其余没有关联的就不额外显示。<br><a href=\"https://segmentfault.com/a/1190000017369618\">具体使用方法请点击</a></p>\n<h3 id=\"25、将数据库中的两个字段拼接\"><a href=\"#25、将数据库中的两个字段拼接\" class=\"headerlink\" title=\"25、将数据库中的两个字段拼接\"></a>25、将数据库中的两个字段拼接</h3><p><code>select id,concat(concat(student_no,&quot;--&quot;),name) as name,class_id from student;</code>：将学生的学号和姓名拼接起来表示（001–小明）。</p>\n<h3 id=\"26、视图\"><a href=\"#26、视图\" class=\"headerlink\" title=\"26、视图\"></a>26、视图</h3><p><strong>说明：</strong>对视图进行增删改操作，也会同步到表，只不过视图中没有的属性列，对应表中的属性列值为null。<br>1、创建视图<br><code>create or replace view stu_view as select id,name from student where id &lt;= 10;</code>：创建一个视图，如果已经存在视图就替换覆盖，从学生表查询id小于等于10的所有学生作为视图中的数据。<br>2、修改视图<br><code>create or replace view stu_view as select id,name from student where id &lt;= 10;</code><br>或者<br><code>alter view stu_view as select id,name from student where id &lt;= 10;</code><br>3、删除视图<br><code>drop view if exists view_stu;</code><br>4、视图检查<br><strong>说明：</strong>如果在创建视图的时候加上 with cascaded（或者是local） check option，那么对视图进行增、删、改操作的时候，必须满足where条件才能成功，不然就失败。<br>（1）<code>cascaded</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">1</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">15</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子二  </span><br><span class=\"line\"># 创建视图一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_1 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 创建试图二</span><br><span class=\"line\"># 当视图二根据视图一所创建的，我们再进行增、删、改操作时，</span><br><span class=\"line\"># 视图一也会默认加上 <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option来进行视图检查。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_2 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> stu_view_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">25</span>大于<span class=\"number\">10</span>可以插入，但是在视图一中，<span class=\"number\">25</span>不小于等于<span class=\"number\">20</span>，所以插入失败。</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">25</span>,<span class=\"string\">&#x27;zxc&#x27;</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">15</span>大于<span class=\"number\">10</span>可以插入，在视图一中，<span class=\"number\">15</span>小于<span class=\"number\">20</span>，所以插入成功。</span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">15</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>（2）<code>local</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> 例子一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">local</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">1</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">15</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子二</span><br><span class=\"line\"># 创建视图一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_1 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 创建视图二</span><br><span class=\"line\"># 当视图二根据视图一所创建的，我们再进行增、删、改操作时，视图一按它自己所规定的来进行。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_2 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> stu_view_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">25</span>大于<span class=\"number\">10</span>可以插入，在视图一中，视图一没有设置视图检查，所以插入成功。</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">25</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">8</span>不大于<span class=\"number\">10</span>，所以插入失败。 </span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">8</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>5、视图更新<br>要使视图可更新，视图中的行与基础表中的行之间必须存在一对一的关系。如果视图包含以下任何一项，则该视图不可更新：<br>（1）聚合函数或窗口函数（sum、min、max、count等）；<br>（2）distinct；<br>（3）group by；<br>（4）having；<br>（5）union 或 unionall  </p>\n<h3 id=\"27、存储过程\"><a href=\"#27、存储过程\" class=\"headerlink\" title=\"27、存储过程\"></a>27、存储过程</h3><p><strong>说明：</strong>存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合，可以接收参数，也可以返回数据。（也就是数据库SQL语言层面的代码封装与重用）<br>1、创建  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> 存储过程名称([参数列表])</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"comment\">-- SQL 语句</span></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子：</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>注意：</strong>在命令行中，执行创建存储过程的SQL时，需要通过关键字delimiter指定SQL语句的结束符。<br>例如：<br>（1）先在命令行执行：<code>delimiter $$</code>（这里表示使用$$符号为结束符）；<br>（2）然后再执行创建语句：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"><span class=\"keyword\">end</span>$$</span><br></pre></td></tr></table></figure>\n<p>2、调用  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">call</span> 名称([参数]);</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子</span><br><span class=\"line\"><span class=\"keyword\">call</span> p1();</span><br></pre></td></tr></table></figure>\n<p>3、查看  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查询指定数据库的存储过程及状态信息</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> information_schema.routines <span class=\"keyword\">where</span> routine_schema <span class=\"operator\">=</span> <span class=\"string\">&#x27;xxx&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 查询某个存储过程的定义</span><br><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> 存储过程名称;</span><br></pre></td></tr></table></figure>\n<p>4、删除  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">procedure</span> [if <span class=\"keyword\">exists</span>] 存储过程名称;</span><br></pre></td></tr></table></figure>\n<p>5、变量<br>（1）系统变量  </p>\n<ol>\n<li>查看系统变量<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看所有系统变量，下面 [] 的意思是二选一</span><br><span class=\"line\"><span class=\"keyword\">show</span> [session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] variables;</span><br><span class=\"line\"></span><br><span class=\"line\"># 可以通过 <span class=\"keyword\">like</span> 模糊匹配方式查找变量</span><br><span class=\"line\"><span class=\"keyword\">show</span> [session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;xxx变量名&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看指定变量的值，两个@表示系统变量</span><br><span class=\"line\"><span class=\"keyword\">select</span> @@[session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] 系统变量名;</span><br></pre></td></tr></table></figure></li>\n<li>设置系统变量<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 第一种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> [session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] 系统变量名 <span class=\"operator\">=</span> 值;</span><br><span class=\"line\"></span><br><span class=\"line\"># 第二种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> @@[session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] 系统变量名 <span class=\"operator\">=</span> 值;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>（2）用户自定义变量<br><strong>说明：</strong>不用提前声明，在用的时候直接用“@变量名” 使用就可以了。（两个@是系统变量，一个@是用户自定义变量）  </p>\n<ol>\n<li>赋值<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用<span class=\"keyword\">set</span>赋值</span><br><span class=\"line\"># 第一种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"variable\">@var_name</span> <span class=\"operator\">=</span> expr [,<span class=\"variable\">@var_name</span> <span class=\"operator\">=</span> expr]...;</span><br><span class=\"line\"># 第二种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr [,<span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr]...;</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用<span class=\"keyword\">select</span>赋值</span><br><span class=\"line\"># 第一种方式</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr [,<span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr]...;</span><br><span class=\"line\"># 第二种方式</span><br><span class=\"line\"><span class=\"keyword\">select</span> 字段名 <span class=\"keyword\">into</span> <span class=\"variable\">@var_name</span> <span class=\"keyword\">from</span> 表名;</span><br></pre></td></tr></table></figure></li>\n<li>使用<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@var_name</span>;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>（3）局部变量<br><strong>说明：</strong>是根据需要定义在局部生效的变量，访问之前，需要 declare 声明，可用作存储过程内的局部变量和输入参数，局部变量的范围是在其内声明的 begin…end 块。  </p>\n<ol>\n<li>声明<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 变量类型就是数据库字段类型</span><br><span class=\"line\"><span class=\"keyword\">declare</span> 变量名 变量类型;</span><br></pre></td></tr></table></figure></li>\n<li>赋值<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> 变量名 <span class=\"operator\">=</span> 值;</span><br><span class=\"line\"><span class=\"keyword\">set</span> 变量名 :<span class=\"operator\">=</span> 值;</span><br><span class=\"line\"><span class=\"keyword\">select</span> 字段名 <span class=\"keyword\">into</span> 变量名 <span class=\"keyword\">from</span> 表名...;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>6、<code>if</code>语法</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if 条件 <span class=\"keyword\">then</span></span><br><span class=\"line\">    ......</span><br><span class=\"line\">elseif 条件<span class=\"number\">2</span> <span class=\"keyword\">then</span>      <span class=\"comment\">-- 可选</span></span><br><span class=\"line\">    ......</span><br><span class=\"line\"><span class=\"keyword\">else</span>                   <span class=\"comment\">-- 可选</span></span><br><span class=\"line\">    ......</span><br><span class=\"line\"><span class=\"keyword\">end</span> if;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 根据定义的分数score变量，判定当前分数对应的分数等级</span><br><span class=\"line\"># score <span class=\"operator\">&gt;=</span> <span class=\"number\">85</span>分，等级为优秀</span><br><span class=\"line\"># score <span class=\"operator\">&gt;=</span> <span class=\"number\">60</span>分且 score <span class=\"operator\">&lt;</span> <span class=\"number\">85</span>分为及格</span><br><span class=\"line\"># score <span class=\"operator\">&lt;</span> <span class=\"number\">60</span>分为不及格</span><br><span class=\"line\"># 无参</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> score <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">58</span>;</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> <span class=\"keyword\">result</span> varcher(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    if  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">85</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;优秀&#x27;</span>;</span><br><span class=\"line\">    elseif  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">60</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;不及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> if;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"keyword\">result</span>; # 将结果查询出来</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 有参（是需要将结果返回）</span><br><span class=\"line\"># 下面参数说明：<span class=\"keyword\">in</span>表示入参，<span class=\"keyword\">out</span>表示返回结果的参数</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p2(<span class=\"keyword\">in</span> score <span class=\"type\">int</span>,<span class=\"keyword\">out</span> <span class=\"keyword\">result</span> <span class=\"type\">varchar</span>(<span class=\"number\">10</span>))</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"></span><br><span class=\"line\">    if  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">85</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;优秀&#x27;</span>;</span><br><span class=\"line\">    elseif  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">60</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;不及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> if;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用，<span class=\"variable\">@result</span>表示 用用户自定义变量接收p2的返回值</span><br><span class=\"line\"><span class=\"keyword\">call</span> p2(<span class=\"number\">68</span>,<span class=\"variable\">@result</span>);</span><br></pre></td></tr></table></figure>\n<p>7、<code>case</code>语法</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法格式</span><br><span class=\"line\"># 语法一，如果search_condition1成立，则执行statement_list1</span><br><span class=\"line\"><span class=\"keyword\">case</span></span><br><span class=\"line\">    <span class=\"keyword\">when</span> search_condition1 <span class=\"keyword\">then</span> statement_list1</span><br><span class=\"line\">    [<span class=\"keyword\">when</span> search_condition2 <span class=\"keyword\">then</span> statement_list2]...</span><br><span class=\"line\">    [<span class=\"keyword\">else</span> statement_list]</span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">case</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 语法二，说明：case_value是表达式，如果表达式的结果为 search_condition1，就执行 search_condition1后的 <span class=\"keyword\">then</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> case_value</span><br><span class=\"line\">    <span class=\"keyword\">when</span> search_condition1 <span class=\"keyword\">then</span> statement_list1</span><br><span class=\"line\">    [<span class=\"keyword\">when</span> search_condition2 <span class=\"keyword\">then</span> statement_list2]...</span><br><span class=\"line\">    [<span class=\"keyword\">else</span> statement_list]</span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">case</span>;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 根据传入的月份，判定月份所属的季节</span><br><span class=\"line\"># <span class=\"number\">1</span><span class=\"number\">-3</span>月份，为第一季度</span><br><span class=\"line\"># <span class=\"number\">4</span><span class=\"number\">-6</span>月份，为第二季度</span><br><span class=\"line\"># <span class=\"number\">7</span><span class=\"number\">-9</span>月份，为第三季度</span><br><span class=\"line\"># <span class=\"number\">10</span><span class=\"number\">-12</span>月份，为第四季度</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1(<span class=\"keyword\">in</span> <span class=\"keyword\">month</span> <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> <span class=\"keyword\">result</span> <span class=\"type\">varchar</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">case</span></span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">3</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第一季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">4</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">6</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第二季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">7</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">9</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第三季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">10</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">12</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第四季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;非法参数&quot;;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">case</span>;</span><br><span class=\"line\">\t# 查询展示，相当于println输出</span><br><span class=\"line\">    <span class=\"keyword\">select</span> concat(<span class=\"string\">&#x27;您输入的月份为：&#x27;</span>,<span class=\"keyword\">month</span>,<span class=\"string\">&#x27;,所有的季度为：&#x27;</span>,<span class=\"keyword\">result</span>);  </span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p1(<span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n<p>8、<code>while</code>语法<br><strong>说明：</strong>满足条件后再执行循环体中的SQL语句。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法，先判定条件，如果条件为<span class=\"literal\">true</span>，则执行逻辑，否则不执行</span><br><span class=\"line\">while 条件 do</span><br><span class=\"line\">    <span class=\"keyword\">SQL</span>逻辑...</span><br><span class=\"line\"><span class=\"keyword\">end</span> while;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子：计算从<span class=\"number\">1</span>累加到n的值，n为传入的参数值。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> n <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> total <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    while n <span class=\"operator\">&gt;</span> <span class=\"number\">0</span> do</span><br><span class=\"line\">        <span class=\"keyword\">set</span> total :<span class=\"operator\">=</span> total <span class=\"operator\">+</span> n;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> n :<span class=\"operator\">=</span> n <span class=\"operator\">-</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> while;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> total;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n<p>9、<code>repeat</code>语法<br><strong>说明：</strong>当满足条件的时候退出循环。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法，先执行一次逻辑，然后判断逻辑是否满足，</span><br><span class=\"line\"># 如果满足就退出；如果不满足就继续循环</span><br><span class=\"line\">repeat</span><br><span class=\"line\">    <span class=\"keyword\">SQL</span>逻辑...</span><br><span class=\"line\">    until 条件</span><br><span class=\"line\"><span class=\"keyword\">end</span> repeat;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子：计算从<span class=\"number\">1</span>累加到n的值，n为传入的参数值。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> n <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> total <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    repeat </span><br><span class=\"line\">        <span class=\"keyword\">set</span> total :<span class=\"operator\">=</span> total <span class=\"operator\">+</span> n;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> n :<span class=\"operator\">=</span> n <span class=\"operator\">-</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    until n <span class=\"operator\">&lt;=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span> repeat;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> total;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n<p>10、<code>loop</code>语法<br><strong>说明：</strong>简单的循环，如果不在SQL逻辑中增加退出循环的条件，可以用来实现简单的死循环。loop配合下面两个语句使用：<br>（1）leave：配合循环使用，退出循环；<br>（2）iterate：必须用在循环中，作用是跳过当前循环剩下的语句，直接进入下一个循环。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法</span><br><span class=\"line\">[begin_label]:loop</span><br><span class=\"line\">    <span class=\"keyword\">SQL</span>逻辑...</span><br><span class=\"line\"><span class=\"keyword\">end</span> loop [end_label];</span><br><span class=\"line\"></span><br><span class=\"line\"># 退出两个语句的使用</span><br><span class=\"line\">leavel label; # 退出指定标记的循环体，label为上面begin_label</span><br><span class=\"line\">iterate label; # 直接进入下一次循环</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子：计算从<span class=\"number\">1</span>累加到n的值，n为传入的参数值。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> n <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> total <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    sum:loop </span><br><span class=\"line\">        if n <span class=\"operator\">&lt;=</span> <span class=\"number\">0</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            leave sum;</span><br><span class=\"line\">        <span class=\"keyword\">end</span> if;</span><br><span class=\"line\">            <span class=\"keyword\">set</span> total :<span class=\"operator\">=</span> total <span class=\"operator\">+</span> n;</span><br><span class=\"line\">            <span class=\"keyword\">set</span> n :<span class=\"operator\">=</span> n <span class=\"operator\">-</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> loop sum;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> total;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n<p>11、游标<code>cursor</code><br><strong>说明：</strong>用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环处理。游标的使用包括游标的声明、open、fetch和close。<br>（1）声明游标<br><code>declare 游标名称 cursor for 查询语句;</code><br>（2）打开游标<br><code>open 游标名称;</code><br>（3）获取游标记录<br><code>fetch 游标名称 into 变量[,变量];</code><br>（4）关闭游标<br><code>close 游标名称;</code><br>例如：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 根据传入的参数 uage，来查询用户表 tb_user 中</span><br><span class=\"line\"># 所有的用户年龄小于等于 uage 的用户姓名和专业</span><br><span class=\"line\"># 并将用户的姓名和专业插入到所创建的一张新表中</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> uage <span class=\"type\">int</span>) # 创建存储过程</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    # 注意：游标的声明必须在普通的声明之后</span><br><span class=\"line\">    # 声明两个变量uname、upro</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> uname <span class=\"type\">varchar</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> upro <span class=\"type\">varchar</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\">    # 声明一个游标，并把查询结果集赋值给这个游标</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> u_cursor <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> <span class=\"keyword\">select</span> name,profession <span class=\"keyword\">from</span> tb_user <span class=\"keyword\">where</span> age <span class=\"operator\">&lt;=</span> uage;</span><br><span class=\"line\">    # 声明一个条件处理程序，如果满足状态<span class=\"number\">02000</span>就关闭游标</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> exit handler <span class=\"keyword\">for</span> <span class=\"keyword\">SQLSTATE</span> <span class=\"string\">&#x27;02000&#x27;</span> <span class=\"keyword\">close</span> u_cursor</span><br><span class=\"line\">     </span><br><span class=\"line\">    # 如果表 tb_user_pro 存在就删除</span><br><span class=\"line\">    <span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">exists</span> tb_user_pro;</span><br><span class=\"line\">    # 如果表 tb_user_pro 不存在就创建</span><br><span class=\"line\">    <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> tb_user_pro(</span><br><span class=\"line\">        id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment,</span><br><span class=\"line\">        name <span class=\"type\">varchar</span>(<span class=\"number\">100</span>),</span><br><span class=\"line\">        profession <span class=\"type\">varchar</span>(<span class=\"number\">100</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    # 开启游标</span><br><span class=\"line\">    <span class=\"keyword\">open</span> u_cursor;</span><br><span class=\"line\">    # 循环遍历游标，将游标中的name和profession的值分别赋值给上面声明的uname和upro</span><br><span class=\"line\">    #  将uanme和upro插入新创建的表 tb_user_pro 中</span><br><span class=\"line\">    while <span class=\"literal\">true</span> do</span><br><span class=\"line\">        <span class=\"keyword\">fetch</span> u_cursor <span class=\"keyword\">into</span> uname,upro;</span><br><span class=\"line\">        <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> tb_user_pro <span class=\"keyword\">values</span>(<span class=\"keyword\">null</span>,uname,upro);</span><br><span class=\"line\">    <span class=\"keyword\">end</span> while;</span><br><span class=\"line\">    # 关闭游标</span><br><span class=\"line\">    <span class=\"keyword\">close</span> u_cursor;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">40</span>);</span><br></pre></td></tr></table></figure>\n<p>12、条件处理程序<code>handler</code><br><strong>说明：</strong>用来定义在流程控制结构执行过程中遇到问题时相应的处理步骤。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法</span><br><span class=\"line\"># handler_action说明：continue:继续执行当前程序  exit:终止执行当前程序</span><br><span class=\"line\"># condition_value说明：<span class=\"keyword\">SQLSTATE</span> sqlstate_value:状态码</span><br><span class=\"line\"><span class=\"keyword\">declare</span> handler_action handler <span class=\"keyword\">for</span> condition_value[,condition_value]... statement;</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子在<span class=\"number\">11</span>例子中</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"28、触发器\"><a href=\"#28、触发器\" class=\"headerlink\" title=\"28、触发器\"></a>28、触发器</h3><p><strong>说明：</strong>可以在insert、update和delete之前或者之后，触发并执行触发器中定义的SQL语句的集合。<br>使用两个 old 和 new 来引用触发器中发生的变化内容：<br>（1）insert型触发器（只有new）<br>new表示将要或者已经新增的数据。<br>（2）update型触发器（有 old 也有 new ）<br>old表示修改之前的数据，new表示将要或已经修改后的数据<br>（3）delete型触发器（只有old）<br>old表示将要或者已经删除的数据<br>1、语法<br>（1）创建  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># trigger_name：触发器名称</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">trigger</span> trigger_name</span><br><span class=\"line\"># 选择是之前还是之后，是插入、更新还是删除</span><br><span class=\"line\">before<span class=\"operator\">/</span>after  <span class=\"keyword\">insert</span><span class=\"operator\">/</span><span class=\"keyword\">update</span><span class=\"operator\">/</span><span class=\"keyword\">delete</span></span><br><span class=\"line\"># table_name：表名。<span class=\"keyword\">for</span> <span class=\"keyword\">each</span> <span class=\"type\">row</span>：行级触发器（mysql中只支持行级）</span><br><span class=\"line\"><span class=\"keyword\">on</span> table_name <span class=\"keyword\">for</span> <span class=\"keyword\">each</span> <span class=\"type\">row</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    trigger_content; # 触发器的逻辑</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n<p>（2）查看<br><code>show triggers;</code><br>（3）删除  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 如果没有指定 schema_name，默认为当前数据库</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">trigger</span> [schema_name.]trigger_name;</span><br></pre></td></tr></table></figure>\n<p>2、例子<br>想要在插入用户表之后，把信息也插入到 tb_user 表中：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">trigger</span> tb_user_insert_trigger</span><br><span class=\"line\">after <span class=\"keyword\">insert</span> <span class=\"keyword\">on</span> tb_user <span class=\"keyword\">for</span> <span class=\"keyword\">each</span> <span class=\"type\">row</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"operator\">/</span><span class=\"operator\">/</span> 说明：new.id：插入到用户表的id；new.name：插入到用户表的姓名</span><br><span class=\"line\">    <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_logs(id,operation,operate_time,operate_id,operate_name) <span class=\"keyword\">values</span>(<span class=\"keyword\">null</span>,<span class=\"string\">&#x27;insert&#x27;</span>,now(),new.id,new.name);</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"29、去重\"><a href=\"#29、去重\" class=\"headerlink\" title=\"29、去重\"></a>29、去重</h3><p>1、使用<code>distinct</code><br>说明：<code>distinct</code>关键词用于返回唯一不同的值，放在查询语句中的第一个字段前使用，且作用于主句所有列。<br>（1）单例去重<br>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slect <span class=\"keyword\">distinct</span> column_name <span class=\"keyword\">from</span> table_name;</span><br></pre></td></tr></table></figure>\n<p>例如：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> age <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">age</span><br><span class=\"line\"><span class=\"comment\">---</span></span><br><span class=\"line\"><span class=\"number\">20</span></span><br><span class=\"line\"><span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n<p>（2）多列去重<br>说明：<code>distinct</code>多列去重，是根据指定的去重列信息来进行，即只有所有指定的列信息都相同，才会被认为是重复的信息。<br>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> column1,column2 <span class=\"keyword\">from</span> table_name;</span><br></pre></td></tr></table></figure>\n<p>例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> sex,age <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"keyword\">null</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br></pre></td></tr></table></figure>\n<p>如果我只想对多列中的某个列去重，怎么做呢？<br>解决办法一：<br>使用<code>group_concat函数</code>（查看group_concant函数教程）  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> group_concat(<span class=\"keyword\">distinct</span> sex) <span class=\"keyword\">as</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>解决办法二：<br>使用<code>group by</code>  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>（3）针对null处理<br><code>distinct</code>不会过滤null值，返回结果会包含null值，比如在多列去重的第一个例子中。<br>所以一般结合<code>count()</code>函数来使用，因为<code>count()</code>函数会过滤掉null项。<br>例如：<br>单使用<code>distinct</code>  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> age <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">age</span><br><span class=\"line\"><span class=\"comment\">----</span></span><br><span class=\"line\"><span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">12</span></span><br><span class=\"line\"><span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n<p>结合<code>count()</code>函数使用  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> age) <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出，实际将<span class=\"keyword\">null</span>过滤掉了</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> age)</span><br><span class=\"line\"><span class=\"comment\">-------------------</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p>2、使用<code>group by</code><br>（1）单列去重<br>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> columns <span class=\"keyword\">from</span> table_name <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> columns;</span><br></pre></td></tr></table></figure>\n<p>例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">age</span><br><span class=\"line\"><span class=\"comment\">----</span></span><br><span class=\"line\"><span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">12</span></span><br><span class=\"line\"><span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n<p>（2）多列去重<br>例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex,age;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"keyword\">null</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br></pre></td></tr></table></figure>\n\n<p>3、两者的区别<br>（1）<code>group by</code>可以在多列去重中进行单列去重，而<code>distinct</code>需要借助其它方式来进行。<code>group by</code>的原理是先对结果进行分组排序，然后返回每组中的第一条数据，且是根据<code>group by</code>的后接字段进行去重的。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>（2）在语义相同，有索引的情况下，<code>group by</code>和<code>distinct</code>都能使用索引，效率相同，因为<code>group by</code>和<code>distinct</code>近乎等价，<code>distinct</code>可以被看做特殊的<code>group by</code>；<br>（3）在语义相同，无索引的情况下，<code>distinct</code>效率高于<code>group by</code>，原因是<code>distinct</code>和<code>group by</code>都会进行分组操作，但<code>group by</code>在Mysql8.0之前会进行隐式排序，导致触发filesort，sql执行效率低下，但从Mysql8.0开始，Mysql就删除了隐式排序，所以，此时在语义相同，无索引的情况下，<code>group by</code>和<code>distinct</code>的执行效率也是近乎等价的。<br>（4）推荐使用<code>group by</code>，因为<code>group by</code>语义更为清晰，可对数据进行更为复杂的一些处理，相比于<code>distinct</code>来说，<code>group by</code>的语义明确，且由于<code>distinct</code>关键字会对所有字段生效，在进行复合业务处理时，<code>group by</code>的使用灵活性更高，<code>group by</code>能根据分组情况，对数据进行更为复杂的处理，例如通过<code>having</code>对数据进行过滤，或通过聚合函数对数据进行运输。  </p>\n<br/>\n\n\n<hr>\n<br/>\n\n\n<h1 id=\"三、使用Mysql遇到的问题\"><a href=\"#三、使用Mysql遇到的问题\" class=\"headerlink\" title=\"三、使用Mysql遇到的问题\"></a>三、使用Mysql遇到的问题</h1><h3 id=\"1、如何解决错误-“public-key-retrieval-is-not-allowed”\"><a href=\"#1、如何解决错误-“public-key-retrieval-is-not-allowed”\" class=\"headerlink\" title=\"1、如何解决错误 “public key retrieval is not allowed”\"></a>1、如何解决错误 “public key retrieval is not allowed”</h3><p>1、说明<br>在使用<code>MySQL</code>数据库时，你可能会遇到一个错误，即<code>public key retrieval is not allowed</code>。这个错误通常出现在尝试连接或访问数据库时，而且可能会导致一些功能无法正常使用。<br>2、错误原因<br><code>public key retrieval is not allowed</code>错误通常是由于<code>MySQL</code>服务器配置的安全设置所导致的。默认情况下，<code>MySQL</code>服务器禁用了<code>public key</code>的检索功能，这是为了增加服务器的安全性而采取的一种措施。在某些情况下，这种设置会导致特定的功能无法正常工作，比如 SSL 连接或使用加密的用户密码。<br>3、解决办法<br>（1）修改<code>MySQL</code>服务器的配置文件以允许<code>public key</code>的检索功能。以下是具体步骤：  </p>\n<ul>\n<li>打开 MySQL 配置文件 my.cnf（或 my.ini）；  </li>\n<li>在 [mysqld] 部分添加或修改以下行：  <figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">//</span> 这个选项将允许所有用户以任意密码连接到 MySQL 服务器。</span><br><span class=\"line\">skip-grant-tables </span><br></pre></td></tr></table></figure></li>\n<li>保存并关闭配置文件；  </li>\n<li>重新启动 MySQL 服务器。</li>\n</ul>\n<p><strong>注意：</strong>这种方法会降低<code>MySQL</code>服务器的安全性，因为所有用户都可以以任意密码连接到服务器。因此，只有在调试或测试环境中使用此方法时才安全，不建议在生产环境中使用。<br>（2）在连接数据库时使用命令行选项来允许 public key 的检索功能。以下是具体步骤：  </p>\n<ul>\n<li>打开命令行终端；  </li>\n<li>输入以下命令连接到 MySQL 服务器：  <figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">//</span> 这个命令将以禁用 SSL 连接的模式连接到 MySQL 服务器，从而允许 public key 的检索功能</span><br><span class=\"line\">mysql <span class=\"params\">--ssl-mode=DISABLED</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">//</span> 如果是springboot yml配置文件，需要添加 allowPublicKeyRetrieval=<span class=\"literal\">true</span></span><br><span class=\"line\">url: jdbc<span class=\"function\">:mysql</span>:<span class=\"string\">//localhost</span><span class=\"function\">:3306</span>/cloud_user?useSSL=<span class=\"literal\">false</span>&amp;allowPublicKeyRetrieval=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></li>\n<li>输入用户名和密码以登录到 MySQL 服务器。</li>\n</ul>\n<p>请注意，这种方法也会降低连接的安全性，因为禁用了 SSL 连接。同样地，只有在调试或测试环境中使用此方法时才安全，不建议在生产环境中使用。<br>（3）使用正式的<code>SSL</code>证书<br>如果你需要在生产环境中使用<code>SSL</code>连接，并且遇到了<code>public key retrieval is not allowed</code>错误，那么你应该考虑使用有效的<code>SSL</code>证书。以下是具体步骤：  </p>\n<ul>\n<li>获取一个有效的 SSL 证书，并确保其配置了正确的公钥；  </li>\n<li>将 SSL 证书和密钥文件放置在指定目录（比如 &#x2F;etc&#x2F;mysql&#x2F;ssl&#x2F;）；  </li>\n<li>打开 MySQL 配置文件 my.cnf（或 my.ini）；  </li>\n<li>在 [mysqld] 部分添加或修改以下行：  <figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">//</span> 这些选项将告诉 MySQL 服务器使用指定的 SSL 证书和密钥文件。</span><br><span class=\"line\">ssl-ca=<span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/ssl/</span>ca-cert.pem</span><br><span class=\"line\">ssl-cert=<span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/ssl/</span>server-cert.pem</span><br><span class=\"line\">ssl-key=<span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/ssl/</span>server-key.pem</span><br></pre></td></tr></table></figure></li>\n<li>保存并关闭配置文件；  </li>\n<li>重新启动 MySQL 服务器。</li>\n</ul>\n<h3 id=\"2、先排序再分组问题\"><a href=\"#2、先排序再分组问题\" class=\"headerlink\" title=\"2、先排序再分组问题\"></a>2、先排序再分组问题</h3><p>1、说明<br>在执行包含了分组、排序的sql时，会先执行<code>group by</code>分组，再执行<code>order by</code>排序，导致排序失效，如果想先排序再分组，解决办法在下面。<br>2、场景<br>拥有一张包含活动信息的数据表，其中涵盖活动名词、开始时间、类型等字段。我的任务是，根据开始时间先排序，然后在每个类型中选择最新的那条记录。<br>3、方法一（针对<code>5.7版本</code>）<br>在子查询中首先对数据进行排序，然后在外部查询中使用分组操作（<strong>注意：</strong>此处子查询必须添加<code>limit</code>，值根据实际情况调整），添加<code>limit</code>可以保留排序后的顺序。<br><code>order by</code>：<code>desc</code>为倒叙（大到小），<code>asc</code>：为正序（小到大）。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> start_time limit <span class=\"number\">100000</span>)t1 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> type <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> type;</span><br></pre></td></tr></table></figure>\n<p>这个查询首先将整个表按照开始时间降序排序，然后在外部查询中按类别进行分组，由于已经排序，每个类型中的第一行即为最新的记录。<br>4、方法二（针对<code>8.0版本</code>）<br>通过使用窗口函数（如<code>row_number()</code>）在内部查询中为每一行分配一个行号，然后在外部查询中筛选行号为1的记录。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> t1.<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> (</span><br><span class=\"line\">  <span class=\"keyword\">select</span> <span class=\"operator\">*</span>,</span><br><span class=\"line\">  <span class=\"built_in\">row_number</span>() <span class=\"keyword\">over</span> (<span class=\"keyword\">partition</span> <span class=\"keyword\">by</span> type <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> start_time <span class=\"keyword\">desc</span>) <span class=\"keyword\">as</span> rn</span><br><span class=\"line\">  <span class=\"keyword\">from</span> test</span><br><span class=\"line\">) t1</span><br><span class=\"line\"><span class=\"keyword\">where</span> t1.rn <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p><code>row_number()</code>：为每一行添加行号；<br><code>partition by type</code>：按照类别分组；<br><code>order by start_time desc</code>：按照开始时间倒叙排序。<br>这个查询首先为每个类型中的每一行分配一个行号，然后在外部查询中筛选行号为1的记录，这些记录即为每个类型中开始时间最新的记录。  </p>\n<br/>\n\n\n<hr>\n<br/>\n\n\n<h1 id=\"四、Mysql函数使用\"><a href=\"#四、Mysql函数使用\" class=\"headerlink\" title=\"四、Mysql函数使用\"></a>四、Mysql函数使用</h1><h3 id=\"1、group-concat函数\"><a href=\"#1、group-concat函数\" class=\"headerlink\" title=\"1、group_concat函数\"></a>1、group_concat函数</h3><p>1、有一张表结构test  </p>\n<figure class=\"highlight gherkin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|<span class=\"string\">   id   </span>|<span class=\"string\">   age   </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   20    </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   20    </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   10    </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   30    </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   40    </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   40    </span>|</span><br><span class=\"line\">|<span class=\"string\">   4    </span>|<span class=\"string\">   50    </span>|</span><br><span class=\"line\">|<span class=\"string\">   4    </span>|<span class=\"string\">   60    </span>|<span class=\"string\">  </span></span><br></pre></td></tr></table></figure>\n<p>2、以id分组，将age字段的值拼成一行，逗号分隔（默认）  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(age)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">20</span>,<span class=\"number\">20</span>,<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>,<span class=\"number\">40</span>,<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>,<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>3、以id分组，将age字段的值拼成一行，分号分隔  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(age separator <span class=\"string\">&#x27;;&#x27;</span>) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(age separator <span class=\"string\">&#x27;;&#x27;</span>)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">20</span>;<span class=\"number\">20</span>;<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>;<span class=\"number\">40</span>;<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>;<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>4、以id分组，去除重复的age值  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(<span class=\"keyword\">distinct</span> age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(<span class=\"keyword\">distinct</span> age)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">20</span>,<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>,<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>,<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>5、以id分组，将age字段的值拼成一行，逗号分隔，并按age排序（<code>desc倒序</code>）  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(age <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(age <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> age)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">20</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>,<span class=\"number\">40</span>,<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>,<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>6、设置group_concat函数长度限制<br>临时设置法：<br>在命令行输入  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> session group_concat_max_len <span class=\"operator\">=</span> <span class=\"number\">18446744073709551615</span>;</span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"keyword\">global</span> max_allowed_packet <span class=\"operator\">=</span> <span class=\"number\">2</span> <span class=\"operator\">*</span> <span class=\"number\">1024</span> <span class=\"operator\">*</span> <span class=\"number\">1024</span> <span class=\"operator\">*</span> <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n<p>永久设置法：<br>在mysql配置文件中添加  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">max_allowed_packet <span class=\"operator\">=</span> <span class=\"number\">20</span>M</span><br><span class=\"line\">group_concat_max_len <span class=\"operator\">=</span> <span class=\"number\">18446744073709551615</span></span><br></pre></td></tr></table></figure>\n<p>重启mysql服务。  </p>\n<h3 id=\"2、concat-ws函数\"><a href=\"#2、concat-ws函数\" class=\"headerlink\" title=\"2、concat_ws函数\"></a>2、concat_ws函数</h3><p>可以用来将一列的值进行拼接，也可以实现多个字段的拼接。<br>1、有一张test表  </p>\n<figure class=\"highlight gherkin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|<span class=\"string\">   id   </span>|<span class=\"string\">   name   </span>|<span class=\"string\">   age   </span>|<span class=\"string\">   gender   </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   Alice  </span>|<span class=\"string\">   25    </span>|<span class=\"string\">   female   </span>|</span><br><span class=\"line\">|<span class=\"string\">   2    </span>|<span class=\"string\">   Bob    </span>|<span class=\"string\">   30    </span>|<span class=\"string\">   male     </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   Alice  </span>|<span class=\"string\">   25    </span>|<span class=\"string\">   female   </span>|</span><br><span class=\"line\">|<span class=\"string\">   4    </span>|<span class=\"string\">   Alice  </span>|<span class=\"string\">   30    </span>|<span class=\"string\">   female   </span>|</span><br></pre></td></tr></table></figure>\n<p>2、例子  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> concat_ws(<span class=\"string\">&#x27;,&#x27;</span>,name,age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> name,age;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">Alice,<span class=\"number\">25</span></span><br><span class=\"line\">Alice,<span class=\"number\">30</span></span><br><span class=\"line\">Bob,<span class=\"number\">30</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3、with-rollup\"><a href=\"#3、with-rollup\" class=\"headerlink\" title=\"3、with rollup\"></a>3、with rollup</h3><p>1、说明<br>可以实现在分组统计数据基础上再进行相同的统计。<br>2、例子<br>例如我们按名字进行分组，再统计每个人登录的次数：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> name,<span class=\"built_in\">sum</span>(sign_num) <span class=\"keyword\">as</span> sign_num <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> name <span class=\"keyword\">with</span> <span class=\"keyword\">rollup</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"operator\">|</span>   name   <span class=\"operator\">|</span>   sign_num   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小丽   <span class=\"operator\">|</span>          <span class=\"number\">2</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小明   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小王   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   <span class=\"keyword\">null</span>   <span class=\"operator\">|</span>          <span class=\"number\">16</span>   <span class=\"operator\">|</span></span><br></pre></td></tr></table></figure>\n<p>其中记录null表示所有人的登录次数，我们可以使用<code>coalesce</code>来设置一个可以取代null的名称，<code>coalesce</code>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> coalescec(a,b,c);</span><br></pre></td></tr></table></figure>\n<p>参数说明：如果a&#x3D;&#x3D;null，则选择b；如果b&#x3D;&#x3D;null，则选择c；如果a!&#x3D;null，则选择a；如果a，b，c都为null，则返回null。<br>修改上面例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">coalesce</span>(name,<span class=\"string\">&#x27;总数&#x27;</span>),<span class=\"built_in\">sum</span>(sign_num) <span class=\"keyword\">as</span> sign_num <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> name <span class=\"keyword\">with</span> <span class=\"keyword\">rollup</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"operator\">|</span>   name   <span class=\"operator\">|</span>   sign_num   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小丽   <span class=\"operator\">|</span>          <span class=\"number\">2</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小明   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小王   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   总数   <span class=\"operator\">|</span>         <span class=\"number\">16</span>   <span class=\"operator\">|</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"4、coalesce函数\"><a href=\"#4、coalesce函数\" class=\"headerlink\" title=\"4、coalesce函数\"></a>4、coalesce函数</h3><p><code>coalesce</code>函数接受多个参数，返回参数列表中的第一个非null值：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> name,<span class=\"built_in\">coalesce</span>(age, <span class=\"number\">0</span>) <span class=\"keyword\">as</span> age <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br></pre></td></tr></table></figure>\n<p>以上sql语句中，如果age为null，则coalesce函数返回0。  </p>\n<h3 id=\"5、ifnull函数\"><a href=\"#5、ifnull函数\" class=\"headerlink\" title=\"5、ifnull函数\"></a>5、ifnull函数</h3><p>是<code>coalesce</code>函数特定版本，它接受两个参数，如果第一个参数为null，则返回第二个参数。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> name,ifnull(age, <span class=\"number\">0</span>) <span class=\"keyword\">as</span> age <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"6、find-in-set函数\"><a href=\"#6、find-in-set函数\" class=\"headerlink\" title=\"6、find_in_set函数\"></a>6、find_in_set函数</h3><p>1、说明<br><code>find_in_set(str,strlist)</code>：查询表中的字段（strlist）中包含（str）的结果，返回结果为记录或null。<br>str：要查询的字符串；<br>strlist：表中的字段名，该字段值要是以<code>,</code>分隔的字符串。<br>2、例子1  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> find_in_set(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;a,b,c,d&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>结果为：2。<br>说明：strlist中下标从1开始，然后b在strlist中下标位置为第二个，所以返回2。<br>3、例子2  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> find_in_set(<span class=\"string\">&#x27;6&#x27;</span>,<span class=\"string\">&#x27;1,2&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>结果为：0。<br>说明：因为6不在strlist中，所以返回0。<br>4、例子3<br>sys_dept表为：  </p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">dept_id</span>  ancestors</span><br><span class=\"line\"><span class=\"attribute\">101</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"attribute\">201</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"attribute\">202</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span>,<span class=\"number\">201</span></span><br><span class=\"line\"><span class=\"attribute\">203</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span>,<span class=\"number\">201</span></span><br><span class=\"line\"><span class=\"attribute\">204</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span>,<span class=\"number\">201</span></span><br></pre></td></tr></table></figure>\n<p>查询语句为：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> dept_id <span class=\"keyword\">from</span> sys_dept <span class=\"keyword\">where</span> find_in_set(<span class=\"string\">&#x27;201&#x27;</span>,ancestors);</span><br></pre></td></tr></table></figure>\n<p>结果为：  </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br></pre></td></tr></table></figure>\n<p>说明：从<code>sys_dept</code>表中查询，ancestors字段中含有201的数据，并只返回dept_id列，如果要查询201根目录和所有子目录数据，比如204，就是：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> dept_id <span class=\"keyword\">from</span> sys_dept <span class=\"keyword\">where</span> find_in_set(<span class=\"string\">&#x27;201&#x27;</span>,ancestors) <span class=\"keyword\">or</span> dept_id <span class=\"operator\">=</span> <span class=\"string\">&#x27;201&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>结果为：  </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br></pre></td></tr></table></figure>\n<p>5、和<code>in</code>的区别<br>弄个测试表：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> `test` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">8</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> auto_increment,</span><br><span class=\"line\">  `name` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  `llist` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  <span class=\"keyword\">primary</span> key(`id`)</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> `test` <span class=\"keyword\">values</span> (<span class=\"number\">1</span>, <span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;daodao,xiaohe,xiaoqin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> `test` <span class=\"keyword\">values</span> (<span class=\"number\">2</span>, <span class=\"string\">&#x27;name2&#x27;</span>,<span class=\"string\">&#x27;daodao,xiaohe,xiaoqin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> `test` <span class=\"keyword\">values</span> (<span class=\"number\">3</span>, <span class=\"string\">&#x27;name3&#x27;</span>,<span class=\"string\">&#x27;daodao,xiaohe,xiaoqin&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>原来以为mysql可以这样查询：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">where</span> <span class=\"string\">&#x27;daodao&#x27;</span> <span class=\"keyword\">in</span> (list); </span><br></pre></td></tr></table></figure>\n<p>上面这样查是查不到的数据的，会为null；只有将list改为：’daodao’,’xiaohe’,’xiaoqin’才能查询到数据，因为list是变量，而’daodao’,’xiaohe’,’xiaoqin’是常量，所以只有改成下面这样才能查询到数据：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">where</span> <span class=\"string\">&#x27;daodao&#x27;</span> <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;daodao&#x27;</span>,<span class=\"string\">&#x27;xiaohe&#x27;</span>,<span class=\"string\">&#x27;xiaoqin&#x27;</span>); </span><br></pre></td></tr></table></figure>\n<p>或者使用<code>find_in_set()</code>：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">where</span> find_in_set(<span class=\"string\">&#x27;daodao&#x27;</span>,list); </span><br></pre></td></tr></table></figure>\n<p>总结：所以如果list是常量，则可以直接用<code>IN</code>， 否则要用<code>find_in_set()</code>函数。  </p>\n<h3 id=\"7、field函数\"><a href=\"#7、field函数\" class=\"headerlink\" title=\"7、field函数\"></a>7、field函数</h3><p>1、使用场景<br>在日常开发过程中，排序是经常用到的，有时候有这样的需求，需要在查询结果中根据某个字段的具体值来排序，比如：有张用户表，想按照‘seiki’、‘iris’来排序。<br>2、例子<br>（1）正序  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># field(str, str1, str2 ,str3.....)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> field(name,<span class=\"string\">&#x27;seiki&#x27;</span>,<span class=\"string\">&#x27;iris&#x27;</span>,<span class=\"string\">&#x27;xut&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id\t\tname\tage</span><br><span class=\"line\"># 这里还有很多记录，不在str1，str2，str3中的记录，然后会把这些记录放在前面</span><br><span class=\"line\"># 把在str1，str2，str3中的记录放在后面，str值相同的按照主键的顺序排列</span><br><span class=\"line\">......（前面还有很多记录，这里省略）</span><br><span class=\"line\"><span class=\"number\">3</span>\t\tseiki\t<span class=\"number\">33</span></span><br><span class=\"line\"><span class=\"number\">4</span>\t\tseiki\t<span class=\"number\">21</span></span><br><span class=\"line\"><span class=\"number\">1</span>\t\tiris\t<span class=\"number\">34</span></span><br><span class=\"line\"><span class=\"number\">2</span>\t\tiris\t<span class=\"number\">45</span></span><br><span class=\"line\"><span class=\"number\">6</span>\t\txut\t\t<span class=\"number\">12</span></span><br><span class=\"line\"><span class=\"number\">12</span>\t\txut\t\t<span class=\"number\">6</span></span><br></pre></td></tr></table></figure>\n<p>（2）倒叙  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> field(name,<span class=\"string\">&#x27;seiki&#x27;</span>,<span class=\"string\">&#x27;iris&#x27;</span>,<span class=\"string\">&#x27;xut&#x27;</span>) <span class=\"keyword\">desc</span>;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"8、char-length函数\"><a href=\"#8、char-length函数\" class=\"headerlink\" title=\"8、char_length函数\"></a>8、char_length函数</h3><p>char_length(str)：返回字符串str的字符数。  </p>\n<h3 id=\"9、concat-ws函数\"><a href=\"#9、concat-ws函数\" class=\"headerlink\" title=\"9、concat_ws函数\"></a>9、concat_ws函数</h3><p>concat_ws(s, s1, s2….sn)：将s1，s2……sn用s连起来。  </p>\n<h3 id=\"10、format函数\"><a href=\"#10、format函数\" class=\"headerlink\" title=\"10、format函数\"></a>10、format函数</h3><p>format(x, n)：将数字x按照“x,xxx.xx”格式返回，n为x保留的小数点位数，最后一位四舍五入。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> format(<span class=\"number\">250500.5634</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"number\">250</span>,<span class=\"number\">500.56</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"11、insert函数\"><a href=\"#11、insert函数\" class=\"headerlink\" title=\"11、insert函数\"></a>11、insert函数</h3><p>insert(str1, x, len, str2)：将str1第x位开始，长度为len的字符串替换为str2。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">insert</span>(<span class=\"string\">&#x27;google.com&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">6</span>, <span class=\"string\">&#x27;runoob&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出，将<span class=\"string\">&#x27;google.com&#x27;</span>从第<span class=\"number\">1</span>位开始，长度为<span class=\"number\">6</span>的字符串替换为<span class=\"string\">&#x27;runoob&#x27;</span></span><br><span class=\"line\">runoob.com</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"12、locate函数\"><a href=\"#12、locate函数\" class=\"headerlink\" title=\"12、locate函数\"></a>12、locate函数</h3><p>locate(str1, str2)：返回str2在str1中第一次出现的位置，如果str2不在str1中，则返回0。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> locate(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;abc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"13、lcase函数、lower函数\"><a href=\"#13、lcase函数、lower函数\" class=\"headerlink\" title=\"13、lcase函数、lower函数\"></a>13、lcase函数、lower函数</h3><p>lcase(str)：将字符串str中的字母全部转换为小写。<br>lower(str)：将字符串str中的字母全部转换为小写。  </p>\n<h3 id=\"14、left函数\"><a href=\"#14、left函数\" class=\"headerlink\" title=\"14、left函数\"></a>14、left函数</h3><p>left(str, len)：返回字符串str的前len个字符。  </p>\n<h3 id=\"15、ltrim函数\"><a href=\"#15、ltrim函数\" class=\"headerlink\" title=\"15、ltrim函数\"></a>15、ltrim函数</h3><p>ltrim(str)：删除字符串str左侧的空格。  </p>\n<h3 id=\"16、position函数\"><a href=\"#16、position函数\" class=\"headerlink\" title=\"16、position函数\"></a>16、position函数</h3><p>position(str1 in s)：从字符串s中获取str1的开始位置。  </p>\n<h3 id=\"17、repeat函数\"><a href=\"#17、repeat函数\" class=\"headerlink\" title=\"17、repeat函数\"></a>17、repeat函数</h3><p>repeat(str, n)：将字符串str重复n次。  </p>\n<h3 id=\"18、replace函数\"><a href=\"#18、replace函数\" class=\"headerlink\" title=\"18、replace函数\"></a>18、replace函数</h3><p>replace(s, s1, s2)：将s中的s1替换为s2。  </p>\n<h3 id=\"19、reverse函数\"><a href=\"#19、reverse函数\" class=\"headerlink\" title=\"19、reverse函数\"></a>19、reverse函数</h3><p>reverse(str)：将字符串str的顺序反过来。  </p>\n","more":"<hr>\n<h1 id=\"一、名词介绍\"><a href=\"#一、名词介绍\" class=\"headerlink\" title=\"一、名词介绍\"></a>一、名词介绍</h1><p>1、<code>DML</code>：数据操作语言，用来对数据库中的数据进行增删改操作，包含以下三个指令：<code>insert</code>、<code>delete</code>、<code>update</code>。<br>2、<code>DDL</code>：数据定义语言，用来定义数据库对象：数据库、数据表、视图、索引等，包含以下三个指令：<code>create</code>、<code>drop</code>、<code>alter</code>。<br>3、<code>DCL</code>：数据控制语言，用来定义数据库的访问权限和安全级别，以及创建用户，授予或回收权限等，包含以下三个指令：<code>grant</code>、<code>revoke</code>、<code>commit</code>。<br>4、<code>DQL</code>：数据查询语言，用来查询数据库中表的记录，使用最多，包含以下三个指令：<code>select</code>、<code>distinct</code>、<code>where</code>。<br>5、事务隔离级别<br>（1）说明：数据库事务的隔离级别是指在多个事务并发执行时，数据库系统为了保证数据一致性所遵循的规定。<br>（2）读未提交（Read Uncommitied）：事务可以读取未被提交的数据，容易产生脏读（一个事务读取了另一个事务未提交的数据，是真正的错误）、不可重复读（一个事务读取了另一个事务提交的修改数据）和幻读（一个事务读取了另一个事务提交的插入数据）等问题。<br>（3）读已提交（Read Commitied）：事务只能读取已经提交的数据，可以避免脏读问题，但可能引发不可重复读和幻读。<br>（4）可重复度（Repeatable Read）：在一个事务中，相同的查询将返回相同的结果集，不管其他事务对数据做了什么修改，可以避免脏读和不可重复读，但仍有幻读的问题。（Mysql默认使用级别）<br>（5）串行化（Serializable）：最高的隔离级别，完全禁止了并发，只允许一个事务执行完毕之后才能执行另一个事务，可以避免以上所有问题，但效率较低，不适用于高并发场景。  </p>\n<br/>\n\n\n<hr>\n<br/>\n\n\n\n<h1 id=\"二、Mysql操作命令\"><a href=\"#二、Mysql操作命令\" class=\"headerlink\" title=\"二、Mysql操作命令\"></a>二、Mysql操作命令</h1><h3 id=\"1、连接mysql\"><a href=\"#1、连接mysql\" class=\"headerlink\" title=\"1、连接mysql\"></a>1、连接mysql</h3><p>在Dos（cmd）命令中执行：<code>mysql -u 【mysql用户名】 -p</code>，然后输入密码，比如：<code>mysql -u root -p root</code>。</p>\n<h3 id=\"2、查看数据库\"><a href=\"#2、查看数据库\" class=\"headerlink\" title=\"2、查看数据库\"></a>2、查看数据库</h3><p>连接mysql之后，执行命令：<code>show databases;</code>（别忘记分号），查看数据库有几个。</p>\n<h3 id=\"3、选择要使用哪个数据库\"><a href=\"#3、选择要使用哪个数据库\" class=\"headerlink\" title=\"3、选择要使用哪个数据库\"></a>3、选择要使用哪个数据库</h3><p><code>use test;</code>：选择使用test数据库。</p>\n<h3 id=\"4、查看数据库里有几个表\"><a href=\"#4、查看数据库里有几个表\" class=\"headerlink\" title=\"4、查看数据库里有几个表\"></a>4、查看数据库里有几个表</h3><p><code>show tables;</code>：查看tables数据库有几个表。</p>\n<h3 id=\"5、创建表\"><a href=\"#5、创建表\" class=\"headerlink\" title=\"5、创建表\"></a>5、创建表</h3><p>在mysql命令行输入：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> student(</span><br><span class=\"line\"><span class=\"operator\">-</span><span class=\"operator\">&gt;</span>id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment comment <span class=\"string\">&#x27;注释&#x27;</span>,</span><br><span class=\"line\"><span class=\"operator\">-</span><span class=\"operator\">&gt;</span>name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>),</span><br><span class=\"line\"><span class=\"operator\">-</span><span class=\"operator\">&gt;</span>sex <span class=\"type\">char</span>(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、查看表结构\"><a href=\"#6、查看表结构\" class=\"headerlink\" title=\"6、查看表结构\"></a>6、查看表结构</h3><p><code>desc student;</code>：查看student表结构。</p>\n<h3 id=\"7、设置中文乱码问题\"><a href=\"#7、设置中文乱码问题\" class=\"headerlink\" title=\"7、设置中文乱码问题\"></a>7、设置中文乱码问题</h3><p>1、查看编码<br><code>show variables like &#39;char%&#39;;</code><br>2、更改编码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> character_set_results<span class=\"operator\">=</span>gbk; #结果显示乱码问题</span><br><span class=\"line\"><span class=\"keyword\">set</span> character_set_client<span class=\"operator\">=</span>gbk; #数据写入报错</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、插入多个数据\"><a href=\"#8、插入多个数据\" class=\"headerlink\" title=\"8、插入多个数据\"></a>8、插入多个数据</h3><p><code>insert into student(name,sex) values (&#39;张三&#39;,&#39;男&#39;),(&#39;李四&#39;,&#39;女&#39;);</code></p>\n<h3 id=\"9、删除数据\"><a href=\"#9、删除数据\" class=\"headerlink\" title=\"9、删除数据\"></a>9、删除数据</h3><p><code>delete from student where name = &#39;张三&#39;;</code></p>\n<h3 id=\"10、更改数据\"><a href=\"#10、更改数据\" class=\"headerlink\" title=\"10、更改数据\"></a>10、更改数据</h3><p><code>update student set name=&#39;张三&#39; where name=&#39;李四&#39;;</code>：把李四改成张三。</p>\n<h3 id=\"11、删除表\"><a href=\"#11、删除表\" class=\"headerlink\" title=\"11、删除表\"></a>11、删除表</h3><p><code>drop table student;</code></p>\n<h3 id=\"12、表中新增一列属性\"><a href=\"#12、表中新增一列属性\" class=\"headerlink\" title=\"12、表中新增一列属性\"></a>12、表中新增一列属性</h3><p>语法：<code>alter table 【表名】 add 【列名】 【列类型】;</code><br>例子：<code>alter table table_name add col_name char(5);</code>（向table_name表新增一列col_name属性，类型为char）<br>如果我们希望添加在指定的一列，可以用：<br><code>alter table table_name add column_name varchar(255) not null after name;</code><br>注意，上面这个命令的意思是说添加新列到某一列后面。如果想添加到第一列的话，可以用：<br><code>alter table table_name add column column_name varchar(255) not null first;</code></p>\n<h3 id=\"13、添加外键\"><a href=\"#13、添加外键\" class=\"headerlink\" title=\"13、添加外键\"></a>13、添加外键</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 从表名 <span class=\"operator\">/</span><span class=\"operator\">/</span>student</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span>   <span class=\"keyword\">ADD</span> <span class=\"keyword\">CONSTRAINT</span> (main_id_con)<span class=\"operator\">/</span><span class=\"operator\">/</span>外键 student里的tid</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span>   <span class=\"keyword\">FOREIGN</span> KEY (main_id)<span class=\"operator\">/</span><span class=\"operator\">/</span>从表外键字段(tid)</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span>   <span class=\"keyword\">REFERENCES</span>  主表(id); <span class=\"operator\">/</span><span class=\"operator\">/</span>teacher</span><br><span class=\"line\">    <span class=\"operator\">-</span><span class=\"operator\">&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"14、多表查询\"><a href=\"#14、多表查询\" class=\"headerlink\" title=\"14、多表查询\"></a>14、多表查询</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span></span><br><span class=\"line\"><span class=\"keyword\">distinct</span> t1.AGENT_ZONE <span class=\"keyword\">as</span> agentzone,   #<span class=\"keyword\">distinct</span> : 去重</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> t1.G_CORP_NAME) <span class=\"keyword\">as</span> unitcount,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> t1.BATCHNO) <span class=\"keyword\">as</span> batchno,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GBA_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> bpnums,  </span><br><span class=\"line\">#<span class=\"keyword\">case</span> <span class=\"keyword\">when</span>:当t1.GAB_BANK_F为<span class=\"number\">2</span>的时候等于<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> bcount,</span><br><span class=\"line\">#<span class=\"keyword\">case</span> <span class=\"keyword\">when</span>:当t1.GAB_BANK_F为<span class=\"number\">2</span>的时候等于G_AMOUNT 的值</span><br><span class=\"line\"><span class=\"built_in\">sum</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;2&#x27;</span> <span class=\"keyword\">then</span> t1.G_AMOUNT <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> bamount,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GBA_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> tpnums,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">then</span> <span class=\"number\">1</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> tcount,</span><br><span class=\"line\"><span class=\"built_in\">sum</span>(<span class=\"keyword\">case</span> t1.GAB_BANK_F <span class=\"keyword\">when</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">then</span> t1.G_AMOUNT <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> tamount</span><br><span class=\"line\"><span class=\"keyword\">from</span> GJT_WAGES_DETAIL t1</span><br><span class=\"line\"># <span class=\"keyword\">left</span> join...on ：连接查询，即使右表中没有匹配，也从左表返回所有的行</span><br><span class=\"line\"><span class=\"keyword\">left</span> <span class=\"keyword\">join</span> GJT_WAGES_SUMMARY t2 </span><br><span class=\"line\"><span class=\"keyword\">on</span> t1.BATCHNO <span class=\"operator\">=</span> t2.BATCHNO</span><br><span class=\"line\"><span class=\"keyword\">where</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> WORKDATE <span class=\"keyword\">between</span> <span class=\"string\">&#x27;2020-04-11&#x27;</span> <span class=\"keyword\">and</span> <span class=\"string\">&#x27;2021-09-12&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> t1.AGENT_ZONE # 以t1.AGENT_ZONE分组  ，分组后如果还要使用<span class=\"keyword\">where</span>条件，就用<span class=\"keyword\">having</span>代替<span class=\"keyword\">where</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"15、修改某一列的字段属性\"><a href=\"#15、修改某一列的字段属性\" class=\"headerlink\" title=\"15、修改某一列的字段属性\"></a>15、修改某一列的字段属性</h3><p><code>alter table user modify column sex varchar(50);</code></p>\n<h3 id=\"16、创建一个新表和某一旧表一样\"><a href=\"#16、创建一个新表和某一旧表一样\" class=\"headerlink\" title=\"16、创建一个新表和某一旧表一样\"></a>16、创建一个新表和某一旧表一样</h3><p><code>create table 【新表名】 like 【旧表名】;</code></p>\n<h3 id=\"17、修改某一列的列名\"><a href=\"#17、修改某一列的列名\" class=\"headerlink\" title=\"17、修改某一列的列名\"></a>17、修改某一列的列名</h3><p><code>alter table 【表名】 change 【旧列名】 【新列名】 【新列名类型】;</code></p>\n<h3 id=\"18、删除某一列\"><a href=\"#18、删除某一列\" class=\"headerlink\" title=\"18、删除某一列\"></a>18、删除某一列</h3><p><code>alter table 【表名】 drop 【列名】;</code></p>\n<h3 id=\"19、修改表名\"><a href=\"#19、修改表名\" class=\"headerlink\" title=\"19、修改表名\"></a>19、修改表名</h3><p><code>rename table 【旧表名】 to 【新表名】;</code></p>\n<h3 id=\"20、蠕虫复制\"><a href=\"#20、蠕虫复制\" class=\"headerlink\" title=\"20、蠕虫复制\"></a>20、蠕虫复制</h3><p><code>insert into 【新表】 select * from 【旧表】;</code><br>如果只想复制某几个字段：<br><code>insert into 【新表】(name,sex) select (name,sex) from 【旧表】;</code></p>\n<h3 id=\"21、单个升序、降序查询\"><a href=\"#21、单个升序、降序查询\" class=\"headerlink\" title=\"21、单个升序、降序查询\"></a>21、单个升序、降序查询</h3><p><code>select * from 【表名】 where 【查询条件】 order by 【根据什么字段】 【ASC/DESC】;</code>(ASC：升序。DESC：降序)</p>\n<h3 id=\"22、多个字段升序、降序查询\"><a href=\"#22、多个字段升序、降序查询\" class=\"headerlink\" title=\"22、多个字段升序、降序查询\"></a>22、多个字段升序、降序查询</h3><p><code>select * from 【表名】 where 【查询条件】 order by 【字段1】 【ASC/DESC】,【字段2】 【ASC/DESC】;</code>（ASC：升序。DESC：降序）<br>（1）想要将null值的数据往后就：（默认）<br><code>select * from 【表名】 where 【查询条件】 order by 【字段】 【ASC/DESC】 nulls last;</code><br>（2）想要将null值的数据往前排就：<br><code>select * from 【表名】 where 【查询条件】 order by 【字段】 【ASC/DESC】 nulls first;</code></p>\n<h3 id=\"23、分页\"><a href=\"#23、分页\" class=\"headerlink\" title=\"23、分页\"></a>23、分页</h3><p><code>limit</code>：跳过几条，当前页显示几条。<br>例如：<br>（1）<code>limit 0,5</code>：跳过0条，从第1条数据开始，显示5条，当前页面显示5条，相当于第一页，查找了5条；<br>（2）<code>limit 5,5</code>：跳过5条，从第6条数据开始，显示5条，当前页面显示5条，相当于第二页，查找了5条；<br>（3）<code>limit 2,5</code>：跳过2条，从第3条数据开始，显示5条，查找出第3、4、5、6、7五条数据显示在当前页面。</p>\n<h3 id=\"24、连接查询\"><a href=\"#24、连接查询\" class=\"headerlink\" title=\"24、连接查询\"></a>24、连接查询</h3><p>1、<code>left join...on...</code>：表1左连接表2，以左为主，表示以表1为主，关联上表2的数据；<br>2、<code>right join...on...</code>：右连接查询，和左连接查询相反；<br>3、<code>inner join...on...</code>：内连接查询，表示以两个表的交集为主，查询出来的数据是两个表交集的部分，其余没有关联的就不额外显示。<br><a href=\"https://segmentfault.com/a/1190000017369618\">具体使用方法请点击</a></p>\n<h3 id=\"25、将数据库中的两个字段拼接\"><a href=\"#25、将数据库中的两个字段拼接\" class=\"headerlink\" title=\"25、将数据库中的两个字段拼接\"></a>25、将数据库中的两个字段拼接</h3><p><code>select id,concat(concat(student_no,&quot;--&quot;),name) as name,class_id from student;</code>：将学生的学号和姓名拼接起来表示（001–小明）。</p>\n<h3 id=\"26、视图\"><a href=\"#26、视图\" class=\"headerlink\" title=\"26、视图\"></a>26、视图</h3><p><strong>说明：</strong>对视图进行增删改操作，也会同步到表，只不过视图中没有的属性列，对应表中的属性列值为null。<br>1、创建视图<br><code>create or replace view stu_view as select id,name from student where id &lt;= 10;</code>：创建一个视图，如果已经存在视图就替换覆盖，从学生表查询id小于等于10的所有学生作为视图中的数据。<br>2、修改视图<br><code>create or replace view stu_view as select id,name from student where id &lt;= 10;</code><br>或者<br><code>alter view stu_view as select id,name from student where id &lt;= 10;</code><br>3、删除视图<br><code>drop view if exists view_stu;</code><br>4、视图检查<br><strong>说明：</strong>如果在创建视图的时候加上 with cascaded（或者是local） check option，那么对视图进行增、删、改操作的时候，必须满足where条件才能成功，不然就失败。<br>（1）<code>cascaded</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">1</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">15</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子二  </span><br><span class=\"line\"># 创建视图一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_1 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 创建试图二</span><br><span class=\"line\"># 当视图二根据视图一所创建的，我们再进行增、删、改操作时，</span><br><span class=\"line\"># 视图一也会默认加上 <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option来进行视图检查。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_2 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> stu_view_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">25</span>大于<span class=\"number\">10</span>可以插入，但是在视图一中，<span class=\"number\">25</span>不小于等于<span class=\"number\">20</span>，所以插入失败。</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">25</span>,<span class=\"string\">&#x27;zxc&#x27;</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">15</span>大于<span class=\"number\">10</span>可以插入，在视图一中，<span class=\"number\">15</span>小于<span class=\"number\">20</span>，所以插入成功。</span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">15</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>（2）<code>local</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> 例子一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">local</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">1</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view <span class=\"keyword\">values</span>(<span class=\"number\">15</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子二</span><br><span class=\"line\"># 创建视图一</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_1 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> student <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 创建视图二</span><br><span class=\"line\"># 当视图二根据视图一所创建的，我们再进行增、删、改操作时，视图一按它自己所规定的来进行。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">or</span> replace <span class=\"keyword\">view</span> stu_view_2 <span class=\"keyword\">as</span> <span class=\"keyword\">select</span> id,name <span class=\"keyword\">from</span> stu_view_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">10</span> <span class=\"keyword\">with</span> <span class=\"keyword\">cascaded</span> <span class=\"keyword\">check</span> option;</span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">25</span>大于<span class=\"number\">10</span>可以插入，在视图一中，视图一没有设置视图检查，所以插入成功。</span><br><span class=\"line\"># 成功的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">25</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 在视图二中，<span class=\"number\">8</span>不大于<span class=\"number\">10</span>，所以插入失败。 </span><br><span class=\"line\"># 失败的是：<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> stu_view_2 <span class=\"keyword\">values</span>(<span class=\"number\">8</span>,<span class=\"string\">&#x27;zxc&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>5、视图更新<br>要使视图可更新，视图中的行与基础表中的行之间必须存在一对一的关系。如果视图包含以下任何一项，则该视图不可更新：<br>（1）聚合函数或窗口函数（sum、min、max、count等）；<br>（2）distinct；<br>（3）group by；<br>（4）having；<br>（5）union 或 unionall  </p>\n<h3 id=\"27、存储过程\"><a href=\"#27、存储过程\" class=\"headerlink\" title=\"27、存储过程\"></a>27、存储过程</h3><p><strong>说明：</strong>存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合，可以接收参数，也可以返回数据。（也就是数据库SQL语言层面的代码封装与重用）<br>1、创建  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> 存储过程名称([参数列表])</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"comment\">-- SQL 语句</span></span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子：</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>注意：</strong>在命令行中，执行创建存储过程的SQL时，需要通过关键字delimiter指定SQL语句的结束符。<br>例如：<br>（1）先在命令行执行：<code>delimiter $$</code>（这里表示使用$$符号为结束符）；<br>（2）然后再执行创建语句：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"><span class=\"keyword\">end</span>$$</span><br></pre></td></tr></table></figure>\n<p>2、调用  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">call</span> 名称([参数]);</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子</span><br><span class=\"line\"><span class=\"keyword\">call</span> p1();</span><br></pre></td></tr></table></figure>\n<p>3、查看  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查询指定数据库的存储过程及状态信息</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> information_schema.routines <span class=\"keyword\">where</span> routine_schema <span class=\"operator\">=</span> <span class=\"string\">&#x27;xxx&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 查询某个存储过程的定义</span><br><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> 存储过程名称;</span><br></pre></td></tr></table></figure>\n<p>4、删除  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">procedure</span> [if <span class=\"keyword\">exists</span>] 存储过程名称;</span><br></pre></td></tr></table></figure>\n<p>5、变量<br>（1）系统变量  </p>\n<ol>\n<li>查看系统变量<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看所有系统变量，下面 [] 的意思是二选一</span><br><span class=\"line\"><span class=\"keyword\">show</span> [session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] variables;</span><br><span class=\"line\"></span><br><span class=\"line\"># 可以通过 <span class=\"keyword\">like</span> 模糊匹配方式查找变量</span><br><span class=\"line\"><span class=\"keyword\">show</span> [session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;xxx变量名&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看指定变量的值，两个@表示系统变量</span><br><span class=\"line\"><span class=\"keyword\">select</span> @@[session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] 系统变量名;</span><br></pre></td></tr></table></figure></li>\n<li>设置系统变量<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 第一种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> [session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] 系统变量名 <span class=\"operator\">=</span> 值;</span><br><span class=\"line\"></span><br><span class=\"line\"># 第二种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> @@[session <span class=\"operator\">|</span> <span class=\"keyword\">global</span>] 系统变量名 <span class=\"operator\">=</span> 值;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>（2）用户自定义变量<br><strong>说明：</strong>不用提前声明，在用的时候直接用“@变量名” 使用就可以了。（两个@是系统变量，一个@是用户自定义变量）  </p>\n<ol>\n<li>赋值<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用<span class=\"keyword\">set</span>赋值</span><br><span class=\"line\"># 第一种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"variable\">@var_name</span> <span class=\"operator\">=</span> expr [,<span class=\"variable\">@var_name</span> <span class=\"operator\">=</span> expr]...;</span><br><span class=\"line\"># 第二种方式</span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr [,<span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr]...;</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用<span class=\"keyword\">select</span>赋值</span><br><span class=\"line\"># 第一种方式</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr [,<span class=\"variable\">@var_name</span> :<span class=\"operator\">=</span> expr]...;</span><br><span class=\"line\"># 第二种方式</span><br><span class=\"line\"><span class=\"keyword\">select</span> 字段名 <span class=\"keyword\">into</span> <span class=\"variable\">@var_name</span> <span class=\"keyword\">from</span> 表名;</span><br></pre></td></tr></table></figure></li>\n<li>使用<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@var_name</span>;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>（3）局部变量<br><strong>说明：</strong>是根据需要定义在局部生效的变量，访问之前，需要 declare 声明，可用作存储过程内的局部变量和输入参数，局部变量的范围是在其内声明的 begin…end 块。  </p>\n<ol>\n<li>声明<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 变量类型就是数据库字段类型</span><br><span class=\"line\"><span class=\"keyword\">declare</span> 变量名 变量类型;</span><br></pre></td></tr></table></figure></li>\n<li>赋值<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> 变量名 <span class=\"operator\">=</span> 值;</span><br><span class=\"line\"><span class=\"keyword\">set</span> 变量名 :<span class=\"operator\">=</span> 值;</span><br><span class=\"line\"><span class=\"keyword\">select</span> 字段名 <span class=\"keyword\">into</span> 变量名 <span class=\"keyword\">from</span> 表名...;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>6、<code>if</code>语法</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if 条件 <span class=\"keyword\">then</span></span><br><span class=\"line\">    ......</span><br><span class=\"line\">elseif 条件<span class=\"number\">2</span> <span class=\"keyword\">then</span>      <span class=\"comment\">-- 可选</span></span><br><span class=\"line\">    ......</span><br><span class=\"line\"><span class=\"keyword\">else</span>                   <span class=\"comment\">-- 可选</span></span><br><span class=\"line\">    ......</span><br><span class=\"line\"><span class=\"keyword\">end</span> if;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 根据定义的分数score变量，判定当前分数对应的分数等级</span><br><span class=\"line\"># score <span class=\"operator\">&gt;=</span> <span class=\"number\">85</span>分，等级为优秀</span><br><span class=\"line\"># score <span class=\"operator\">&gt;=</span> <span class=\"number\">60</span>分且 score <span class=\"operator\">&lt;</span> <span class=\"number\">85</span>分为及格</span><br><span class=\"line\"># score <span class=\"operator\">&lt;</span> <span class=\"number\">60</span>分为不及格</span><br><span class=\"line\"># 无参</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> score <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">58</span>;</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> <span class=\"keyword\">result</span> varcher(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    if  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">85</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;优秀&#x27;</span>;</span><br><span class=\"line\">    elseif  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">60</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;不及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> if;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"keyword\">result</span>; # 将结果查询出来</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 有参（是需要将结果返回）</span><br><span class=\"line\"># 下面参数说明：<span class=\"keyword\">in</span>表示入参，<span class=\"keyword\">out</span>表示返回结果的参数</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p2(<span class=\"keyword\">in</span> score <span class=\"type\">int</span>,<span class=\"keyword\">out</span> <span class=\"keyword\">result</span> <span class=\"type\">varchar</span>(<span class=\"number\">10</span>))</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"></span><br><span class=\"line\">    if  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">85</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;优秀&#x27;</span>;</span><br><span class=\"line\">    elseif  score  <span class=\"operator\">&gt;=</span>  <span class=\"number\">60</span>  <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">set</span>  <span class=\"keyword\">result</span>  :<span class=\"operator\">=</span>  <span class=\"string\">&#x27;不及格&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> if;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用，<span class=\"variable\">@result</span>表示 用用户自定义变量接收p2的返回值</span><br><span class=\"line\"><span class=\"keyword\">call</span> p2(<span class=\"number\">68</span>,<span class=\"variable\">@result</span>);</span><br></pre></td></tr></table></figure>\n<p>7、<code>case</code>语法</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法格式</span><br><span class=\"line\"># 语法一，如果search_condition1成立，则执行statement_list1</span><br><span class=\"line\"><span class=\"keyword\">case</span></span><br><span class=\"line\">    <span class=\"keyword\">when</span> search_condition1 <span class=\"keyword\">then</span> statement_list1</span><br><span class=\"line\">    [<span class=\"keyword\">when</span> search_condition2 <span class=\"keyword\">then</span> statement_list2]...</span><br><span class=\"line\">    [<span class=\"keyword\">else</span> statement_list]</span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">case</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 语法二，说明：case_value是表达式，如果表达式的结果为 search_condition1，就执行 search_condition1后的 <span class=\"keyword\">then</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> case_value</span><br><span class=\"line\">    <span class=\"keyword\">when</span> search_condition1 <span class=\"keyword\">then</span> statement_list1</span><br><span class=\"line\">    [<span class=\"keyword\">when</span> search_condition2 <span class=\"keyword\">then</span> statement_list2]...</span><br><span class=\"line\">    [<span class=\"keyword\">else</span> statement_list]</span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">case</span>;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 根据传入的月份，判定月份所属的季节</span><br><span class=\"line\"># <span class=\"number\">1</span><span class=\"number\">-3</span>月份，为第一季度</span><br><span class=\"line\"># <span class=\"number\">4</span><span class=\"number\">-6</span>月份，为第二季度</span><br><span class=\"line\"># <span class=\"number\">7</span><span class=\"number\">-9</span>月份，为第三季度</span><br><span class=\"line\"># <span class=\"number\">10</span><span class=\"number\">-12</span>月份，为第四季度</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p1(<span class=\"keyword\">in</span> <span class=\"keyword\">month</span> <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> <span class=\"keyword\">result</span> <span class=\"type\">varchar</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">case</span></span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">3</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第一季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">4</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">6</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第二季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">7</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">9</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第三季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">when</span> <span class=\"keyword\">month</span> <span class=\"operator\">&gt;=</span> <span class=\"number\">10</span> <span class=\"keyword\">and</span> <span class=\"keyword\">month</span> <span class=\"operator\">&lt;=</span> <span class=\"number\">12</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;第四季度&quot;;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"keyword\">set</span> <span class=\"keyword\">result</span> :<span class=\"operator\">=</span> &quot;非法参数&quot;;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">case</span>;</span><br><span class=\"line\">\t# 查询展示，相当于println输出</span><br><span class=\"line\">    <span class=\"keyword\">select</span> concat(<span class=\"string\">&#x27;您输入的月份为：&#x27;</span>,<span class=\"keyword\">month</span>,<span class=\"string\">&#x27;,所有的季度为：&#x27;</span>,<span class=\"keyword\">result</span>);  </span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p1(<span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n<p>8、<code>while</code>语法<br><strong>说明：</strong>满足条件后再执行循环体中的SQL语句。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法，先判定条件，如果条件为<span class=\"literal\">true</span>，则执行逻辑，否则不执行</span><br><span class=\"line\">while 条件 do</span><br><span class=\"line\">    <span class=\"keyword\">SQL</span>逻辑...</span><br><span class=\"line\"><span class=\"keyword\">end</span> while;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子：计算从<span class=\"number\">1</span>累加到n的值，n为传入的参数值。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> n <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> total <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    while n <span class=\"operator\">&gt;</span> <span class=\"number\">0</span> do</span><br><span class=\"line\">        <span class=\"keyword\">set</span> total :<span class=\"operator\">=</span> total <span class=\"operator\">+</span> n;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> n :<span class=\"operator\">=</span> n <span class=\"operator\">-</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> while;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> total;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n<p>9、<code>repeat</code>语法<br><strong>说明：</strong>当满足条件的时候退出循环。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法，先执行一次逻辑，然后判断逻辑是否满足，</span><br><span class=\"line\"># 如果满足就退出；如果不满足就继续循环</span><br><span class=\"line\">repeat</span><br><span class=\"line\">    <span class=\"keyword\">SQL</span>逻辑...</span><br><span class=\"line\">    until 条件</span><br><span class=\"line\"><span class=\"keyword\">end</span> repeat;</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子：计算从<span class=\"number\">1</span>累加到n的值，n为传入的参数值。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> n <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> total <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    repeat </span><br><span class=\"line\">        <span class=\"keyword\">set</span> total :<span class=\"operator\">=</span> total <span class=\"operator\">+</span> n;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> n :<span class=\"operator\">=</span> n <span class=\"operator\">-</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    until n <span class=\"operator\">&lt;=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span> repeat;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> total;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n<p>10、<code>loop</code>语法<br><strong>说明：</strong>简单的循环，如果不在SQL逻辑中增加退出循环的条件，可以用来实现简单的死循环。loop配合下面两个语句使用：<br>（1）leave：配合循环使用，退出循环；<br>（2）iterate：必须用在循环中，作用是跳过当前循环剩下的语句，直接进入下一个循环。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法</span><br><span class=\"line\">[begin_label]:loop</span><br><span class=\"line\">    <span class=\"keyword\">SQL</span>逻辑...</span><br><span class=\"line\"><span class=\"keyword\">end</span> loop [end_label];</span><br><span class=\"line\"></span><br><span class=\"line\"># 退出两个语句的使用</span><br><span class=\"line\">leavel label; # 退出指定标记的循环体，label为上面begin_label</span><br><span class=\"line\">iterate label; # 直接进入下一次循环</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 例子：计算从<span class=\"number\">1</span>累加到n的值，n为传入的参数值。</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> n <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"keyword\">declare</span> total <span class=\"type\">int</span> <span class=\"keyword\">default</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    sum:loop </span><br><span class=\"line\">        if n <span class=\"operator\">&lt;=</span> <span class=\"number\">0</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            leave sum;</span><br><span class=\"line\">        <span class=\"keyword\">end</span> if;</span><br><span class=\"line\">            <span class=\"keyword\">set</span> total :<span class=\"operator\">=</span> total <span class=\"operator\">+</span> n;</span><br><span class=\"line\">            <span class=\"keyword\">set</span> n :<span class=\"operator\">=</span> n <span class=\"operator\">-</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">end</span> loop sum;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> total;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">10</span>);</span><br></pre></td></tr></table></figure>\n<p>11、游标<code>cursor</code><br><strong>说明：</strong>用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环处理。游标的使用包括游标的声明、open、fetch和close。<br>（1）声明游标<br><code>declare 游标名称 cursor for 查询语句;</code><br>（2）打开游标<br><code>open 游标名称;</code><br>（3）获取游标记录<br><code>fetch 游标名称 into 变量[,变量];</code><br>（4）关闭游标<br><code>close 游标名称;</code><br>例如：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 根据传入的参数 uage，来查询用户表 tb_user 中</span><br><span class=\"line\"># 所有的用户年龄小于等于 uage 的用户姓名和专业</span><br><span class=\"line\"># 并将用户的姓名和专业插入到所创建的一张新表中</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> p(<span class=\"keyword\">in</span> uage <span class=\"type\">int</span>) # 创建存储过程</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    # 注意：游标的声明必须在普通的声明之后</span><br><span class=\"line\">    # 声明两个变量uname、upro</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> uname <span class=\"type\">varchar</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> upro <span class=\"type\">varchar</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\">    # 声明一个游标，并把查询结果集赋值给这个游标</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> u_cursor <span class=\"keyword\">cursor</span> <span class=\"keyword\">for</span> <span class=\"keyword\">select</span> name,profession <span class=\"keyword\">from</span> tb_user <span class=\"keyword\">where</span> age <span class=\"operator\">&lt;=</span> uage;</span><br><span class=\"line\">    # 声明一个条件处理程序，如果满足状态<span class=\"number\">02000</span>就关闭游标</span><br><span class=\"line\">    <span class=\"keyword\">declare</span> exit handler <span class=\"keyword\">for</span> <span class=\"keyword\">SQLSTATE</span> <span class=\"string\">&#x27;02000&#x27;</span> <span class=\"keyword\">close</span> u_cursor</span><br><span class=\"line\">     </span><br><span class=\"line\">    # 如果表 tb_user_pro 存在就删除</span><br><span class=\"line\">    <span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">exists</span> tb_user_pro;</span><br><span class=\"line\">    # 如果表 tb_user_pro 不存在就创建</span><br><span class=\"line\">    <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> tb_user_pro(</span><br><span class=\"line\">        id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment,</span><br><span class=\"line\">        name <span class=\"type\">varchar</span>(<span class=\"number\">100</span>),</span><br><span class=\"line\">        profession <span class=\"type\">varchar</span>(<span class=\"number\">100</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    # 开启游标</span><br><span class=\"line\">    <span class=\"keyword\">open</span> u_cursor;</span><br><span class=\"line\">    # 循环遍历游标，将游标中的name和profession的值分别赋值给上面声明的uname和upro</span><br><span class=\"line\">    #  将uanme和upro插入新创建的表 tb_user_pro 中</span><br><span class=\"line\">    while <span class=\"literal\">true</span> do</span><br><span class=\"line\">        <span class=\"keyword\">fetch</span> u_cursor <span class=\"keyword\">into</span> uname,upro;</span><br><span class=\"line\">        <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> tb_user_pro <span class=\"keyword\">values</span>(<span class=\"keyword\">null</span>,uname,upro);</span><br><span class=\"line\">    <span class=\"keyword\">end</span> while;</span><br><span class=\"line\">    # 关闭游标</span><br><span class=\"line\">    <span class=\"keyword\">close</span> u_cursor;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用</span><br><span class=\"line\"><span class=\"keyword\">call</span> p(<span class=\"number\">40</span>);</span><br></pre></td></tr></table></figure>\n<p>12、条件处理程序<code>handler</code><br><strong>说明：</strong>用来定义在流程控制结构执行过程中遇到问题时相应的处理步骤。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法</span><br><span class=\"line\"># handler_action说明：continue:继续执行当前程序  exit:终止执行当前程序</span><br><span class=\"line\"># condition_value说明：<span class=\"keyword\">SQLSTATE</span> sqlstate_value:状态码</span><br><span class=\"line\"><span class=\"keyword\">declare</span> handler_action handler <span class=\"keyword\">for</span> condition_value[,condition_value]... statement;</span><br><span class=\"line\"></span><br><span class=\"line\"># 例子在<span class=\"number\">11</span>例子中</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"28、触发器\"><a href=\"#28、触发器\" class=\"headerlink\" title=\"28、触发器\"></a>28、触发器</h3><p><strong>说明：</strong>可以在insert、update和delete之前或者之后，触发并执行触发器中定义的SQL语句的集合。<br>使用两个 old 和 new 来引用触发器中发生的变化内容：<br>（1）insert型触发器（只有new）<br>new表示将要或者已经新增的数据。<br>（2）update型触发器（有 old 也有 new ）<br>old表示修改之前的数据，new表示将要或已经修改后的数据<br>（3）delete型触发器（只有old）<br>old表示将要或者已经删除的数据<br>1、语法<br>（1）创建  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># trigger_name：触发器名称</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">trigger</span> trigger_name</span><br><span class=\"line\"># 选择是之前还是之后，是插入、更新还是删除</span><br><span class=\"line\">before<span class=\"operator\">/</span>after  <span class=\"keyword\">insert</span><span class=\"operator\">/</span><span class=\"keyword\">update</span><span class=\"operator\">/</span><span class=\"keyword\">delete</span></span><br><span class=\"line\"># table_name：表名。<span class=\"keyword\">for</span> <span class=\"keyword\">each</span> <span class=\"type\">row</span>：行级触发器（mysql中只支持行级）</span><br><span class=\"line\"><span class=\"keyword\">on</span> table_name <span class=\"keyword\">for</span> <span class=\"keyword\">each</span> <span class=\"type\">row</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    trigger_content; # 触发器的逻辑</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n<p>（2）查看<br><code>show triggers;</code><br>（3）删除  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 如果没有指定 schema_name，默认为当前数据库</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">trigger</span> [schema_name.]trigger_name;</span><br></pre></td></tr></table></figure>\n<p>2、例子<br>想要在插入用户表之后，把信息也插入到 tb_user 表中：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">trigger</span> tb_user_insert_trigger</span><br><span class=\"line\">after <span class=\"keyword\">insert</span> <span class=\"keyword\">on</span> tb_user <span class=\"keyword\">for</span> <span class=\"keyword\">each</span> <span class=\"type\">row</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    <span class=\"operator\">/</span><span class=\"operator\">/</span> 说明：new.id：插入到用户表的id；new.name：插入到用户表的姓名</span><br><span class=\"line\">    <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_logs(id,operation,operate_time,operate_id,operate_name) <span class=\"keyword\">values</span>(<span class=\"keyword\">null</span>,<span class=\"string\">&#x27;insert&#x27;</span>,now(),new.id,new.name);</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"29、去重\"><a href=\"#29、去重\" class=\"headerlink\" title=\"29、去重\"></a>29、去重</h3><p>1、使用<code>distinct</code><br>说明：<code>distinct</code>关键词用于返回唯一不同的值，放在查询语句中的第一个字段前使用，且作用于主句所有列。<br>（1）单例去重<br>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slect <span class=\"keyword\">distinct</span> column_name <span class=\"keyword\">from</span> table_name;</span><br></pre></td></tr></table></figure>\n<p>例如：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> age <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">age</span><br><span class=\"line\"><span class=\"comment\">---</span></span><br><span class=\"line\"><span class=\"number\">20</span></span><br><span class=\"line\"><span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n<p>（2）多列去重<br>说明：<code>distinct</code>多列去重，是根据指定的去重列信息来进行，即只有所有指定的列信息都相同，才会被认为是重复的信息。<br>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> column1,column2 <span class=\"keyword\">from</span> table_name;</span><br></pre></td></tr></table></figure>\n<p>例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> sex,age <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"keyword\">null</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br></pre></td></tr></table></figure>\n<p>如果我只想对多列中的某个列去重，怎么做呢？<br>解决办法一：<br>使用<code>group_concat函数</code>（查看group_concant函数教程）  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> group_concat(<span class=\"keyword\">distinct</span> sex) <span class=\"keyword\">as</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>解决办法二：<br>使用<code>group by</code>  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>（3）针对null处理<br><code>distinct</code>不会过滤null值，返回结果会包含null值，比如在多列去重的第一个例子中。<br>所以一般结合<code>count()</code>函数来使用，因为<code>count()</code>函数会过滤掉null项。<br>例如：<br>单使用<code>distinct</code>  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> age <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">age</span><br><span class=\"line\"><span class=\"comment\">----</span></span><br><span class=\"line\"><span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">12</span></span><br><span class=\"line\"><span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n<p>结合<code>count()</code>函数使用  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> age) <span class=\"keyword\">from</span> student;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出，实际将<span class=\"keyword\">null</span>过滤掉了</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span> age)</span><br><span class=\"line\"><span class=\"comment\">-------------------</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p>2、使用<code>group by</code><br>（1）单列去重<br>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> columns <span class=\"keyword\">from</span> table_name <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> columns;</span><br></pre></td></tr></table></figure>\n<p>例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">age</span><br><span class=\"line\"><span class=\"comment\">----</span></span><br><span class=\"line\"><span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">12</span></span><br><span class=\"line\"><span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n<p>（2）多列去重<br>例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex,age;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"keyword\">null</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">11</span></span><br></pre></td></tr></table></figure>\n\n<p>3、两者的区别<br>（1）<code>group by</code>可以在多列去重中进行单列去重，而<code>distinct</code>需要借助其它方式来进行。<code>group by</code>的原理是先对结果进行分组排序，然后返回每组中的第一条数据，且是根据<code>group by</code>的后接字段进行去重的。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> sex,age <span class=\"keyword\">from</span> student <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> sex;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">sex    <span class=\"operator\">|</span>   age</span><br><span class=\"line\"><span class=\"comment\">-------+-------</span></span><br><span class=\"line\">male   <span class=\"operator\">|</span>   <span class=\"number\">10</span></span><br><span class=\"line\">female <span class=\"operator\">|</span>   <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>（2）在语义相同，有索引的情况下，<code>group by</code>和<code>distinct</code>都能使用索引，效率相同，因为<code>group by</code>和<code>distinct</code>近乎等价，<code>distinct</code>可以被看做特殊的<code>group by</code>；<br>（3）在语义相同，无索引的情况下，<code>distinct</code>效率高于<code>group by</code>，原因是<code>distinct</code>和<code>group by</code>都会进行分组操作，但<code>group by</code>在Mysql8.0之前会进行隐式排序，导致触发filesort，sql执行效率低下，但从Mysql8.0开始，Mysql就删除了隐式排序，所以，此时在语义相同，无索引的情况下，<code>group by</code>和<code>distinct</code>的执行效率也是近乎等价的。<br>（4）推荐使用<code>group by</code>，因为<code>group by</code>语义更为清晰，可对数据进行更为复杂的一些处理，相比于<code>distinct</code>来说，<code>group by</code>的语义明确，且由于<code>distinct</code>关键字会对所有字段生效，在进行复合业务处理时，<code>group by</code>的使用灵活性更高，<code>group by</code>能根据分组情况，对数据进行更为复杂的处理，例如通过<code>having</code>对数据进行过滤，或通过聚合函数对数据进行运输。  </p>\n<br/>\n\n\n<hr>\n<br/>\n\n\n<h1 id=\"三、使用Mysql遇到的问题\"><a href=\"#三、使用Mysql遇到的问题\" class=\"headerlink\" title=\"三、使用Mysql遇到的问题\"></a>三、使用Mysql遇到的问题</h1><h3 id=\"1、如何解决错误-“public-key-retrieval-is-not-allowed”\"><a href=\"#1、如何解决错误-“public-key-retrieval-is-not-allowed”\" class=\"headerlink\" title=\"1、如何解决错误 “public key retrieval is not allowed”\"></a>1、如何解决错误 “public key retrieval is not allowed”</h3><p>1、说明<br>在使用<code>MySQL</code>数据库时，你可能会遇到一个错误，即<code>public key retrieval is not allowed</code>。这个错误通常出现在尝试连接或访问数据库时，而且可能会导致一些功能无法正常使用。<br>2、错误原因<br><code>public key retrieval is not allowed</code>错误通常是由于<code>MySQL</code>服务器配置的安全设置所导致的。默认情况下，<code>MySQL</code>服务器禁用了<code>public key</code>的检索功能，这是为了增加服务器的安全性而采取的一种措施。在某些情况下，这种设置会导致特定的功能无法正常工作，比如 SSL 连接或使用加密的用户密码。<br>3、解决办法<br>（1）修改<code>MySQL</code>服务器的配置文件以允许<code>public key</code>的检索功能。以下是具体步骤：  </p>\n<ul>\n<li>打开 MySQL 配置文件 my.cnf（或 my.ini）；  </li>\n<li>在 [mysqld] 部分添加或修改以下行：  <figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">//</span> 这个选项将允许所有用户以任意密码连接到 MySQL 服务器。</span><br><span class=\"line\">skip-grant-tables </span><br></pre></td></tr></table></figure></li>\n<li>保存并关闭配置文件；  </li>\n<li>重新启动 MySQL 服务器。</li>\n</ul>\n<p><strong>注意：</strong>这种方法会降低<code>MySQL</code>服务器的安全性，因为所有用户都可以以任意密码连接到服务器。因此，只有在调试或测试环境中使用此方法时才安全，不建议在生产环境中使用。<br>（2）在连接数据库时使用命令行选项来允许 public key 的检索功能。以下是具体步骤：  </p>\n<ul>\n<li>打开命令行终端；  </li>\n<li>输入以下命令连接到 MySQL 服务器：  <figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">//</span> 这个命令将以禁用 SSL 连接的模式连接到 MySQL 服务器，从而允许 public key 的检索功能</span><br><span class=\"line\">mysql <span class=\"params\">--ssl-mode=DISABLED</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">//</span> 如果是springboot yml配置文件，需要添加 allowPublicKeyRetrieval=<span class=\"literal\">true</span></span><br><span class=\"line\">url: jdbc<span class=\"function\">:mysql</span>:<span class=\"string\">//localhost</span><span class=\"function\">:3306</span>/cloud_user?useSSL=<span class=\"literal\">false</span>&amp;allowPublicKeyRetrieval=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></li>\n<li>输入用户名和密码以登录到 MySQL 服务器。</li>\n</ul>\n<p>请注意，这种方法也会降低连接的安全性，因为禁用了 SSL 连接。同样地，只有在调试或测试环境中使用此方法时才安全，不建议在生产环境中使用。<br>（3）使用正式的<code>SSL</code>证书<br>如果你需要在生产环境中使用<code>SSL</code>连接，并且遇到了<code>public key retrieval is not allowed</code>错误，那么你应该考虑使用有效的<code>SSL</code>证书。以下是具体步骤：  </p>\n<ul>\n<li>获取一个有效的 SSL 证书，并确保其配置了正确的公钥；  </li>\n<li>将 SSL 证书和密钥文件放置在指定目录（比如 &#x2F;etc&#x2F;mysql&#x2F;ssl&#x2F;）；  </li>\n<li>打开 MySQL 配置文件 my.cnf（或 my.ini）；  </li>\n<li>在 [mysqld] 部分添加或修改以下行：  <figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">//</span> 这些选项将告诉 MySQL 服务器使用指定的 SSL 证书和密钥文件。</span><br><span class=\"line\">ssl-ca=<span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/ssl/</span>ca-cert.pem</span><br><span class=\"line\">ssl-cert=<span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/ssl/</span>server-cert.pem</span><br><span class=\"line\">ssl-key=<span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/ssl/</span>server-key.pem</span><br></pre></td></tr></table></figure></li>\n<li>保存并关闭配置文件；  </li>\n<li>重新启动 MySQL 服务器。</li>\n</ul>\n<h3 id=\"2、先排序再分组问题\"><a href=\"#2、先排序再分组问题\" class=\"headerlink\" title=\"2、先排序再分组问题\"></a>2、先排序再分组问题</h3><p>1、说明<br>在执行包含了分组、排序的sql时，会先执行<code>group by</code>分组，再执行<code>order by</code>排序，导致排序失效，如果想先排序再分组，解决办法在下面。<br>2、场景<br>拥有一张包含活动信息的数据表，其中涵盖活动名词、开始时间、类型等字段。我的任务是，根据开始时间先排序，然后在每个类型中选择最新的那条记录。<br>3、方法一（针对<code>5.7版本</code>）<br>在子查询中首先对数据进行排序，然后在外部查询中使用分组操作（<strong>注意：</strong>此处子查询必须添加<code>limit</code>，值根据实际情况调整），添加<code>limit</code>可以保留排序后的顺序。<br><code>order by</code>：<code>desc</code>为倒叙（大到小），<code>asc</code>：为正序（小到大）。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> start_time limit <span class=\"number\">100000</span>)t1 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> type <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> type;</span><br></pre></td></tr></table></figure>\n<p>这个查询首先将整个表按照开始时间降序排序，然后在外部查询中按类别进行分组，由于已经排序，每个类型中的第一行即为最新的记录。<br>4、方法二（针对<code>8.0版本</code>）<br>通过使用窗口函数（如<code>row_number()</code>）在内部查询中为每一行分配一个行号，然后在外部查询中筛选行号为1的记录。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> t1.<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> (</span><br><span class=\"line\">  <span class=\"keyword\">select</span> <span class=\"operator\">*</span>,</span><br><span class=\"line\">  <span class=\"built_in\">row_number</span>() <span class=\"keyword\">over</span> (<span class=\"keyword\">partition</span> <span class=\"keyword\">by</span> type <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> start_time <span class=\"keyword\">desc</span>) <span class=\"keyword\">as</span> rn</span><br><span class=\"line\">  <span class=\"keyword\">from</span> test</span><br><span class=\"line\">) t1</span><br><span class=\"line\"><span class=\"keyword\">where</span> t1.rn <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p><code>row_number()</code>：为每一行添加行号；<br><code>partition by type</code>：按照类别分组；<br><code>order by start_time desc</code>：按照开始时间倒叙排序。<br>这个查询首先为每个类型中的每一行分配一个行号，然后在外部查询中筛选行号为1的记录，这些记录即为每个类型中开始时间最新的记录。  </p>\n<br/>\n\n\n<hr>\n<br/>\n\n\n<h1 id=\"四、Mysql函数使用\"><a href=\"#四、Mysql函数使用\" class=\"headerlink\" title=\"四、Mysql函数使用\"></a>四、Mysql函数使用</h1><h3 id=\"1、group-concat函数\"><a href=\"#1、group-concat函数\" class=\"headerlink\" title=\"1、group_concat函数\"></a>1、group_concat函数</h3><p>1、有一张表结构test  </p>\n<figure class=\"highlight gherkin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|<span class=\"string\">   id   </span>|<span class=\"string\">   age   </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   20    </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   20    </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   10    </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   30    </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   40    </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   40    </span>|</span><br><span class=\"line\">|<span class=\"string\">   4    </span>|<span class=\"string\">   50    </span>|</span><br><span class=\"line\">|<span class=\"string\">   4    </span>|<span class=\"string\">   60    </span>|<span class=\"string\">  </span></span><br></pre></td></tr></table></figure>\n<p>2、以id分组，将age字段的值拼成一行，逗号分隔（默认）  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(age)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">20</span>,<span class=\"number\">20</span>,<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>,<span class=\"number\">40</span>,<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>,<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>3、以id分组，将age字段的值拼成一行，分号分隔  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(age separator <span class=\"string\">&#x27;;&#x27;</span>) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(age separator <span class=\"string\">&#x27;;&#x27;</span>)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">20</span>;<span class=\"number\">20</span>;<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>;<span class=\"number\">40</span>;<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>;<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>4、以id分组，去除重复的age值  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(<span class=\"keyword\">distinct</span> age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(<span class=\"keyword\">distinct</span> age)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">20</span>,<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>,<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>,<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>5、以id分组，将age字段的值拼成一行，逗号分隔，并按age排序（<code>desc倒序</code>）  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id,group_concat(age <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> id;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id   <span class=\"operator\">|</span>   group_concat(age <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> age)</span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"operator\">|</span>   <span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">20</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"operator\">|</span>   <span class=\"number\">30</span>,<span class=\"number\">40</span>,<span class=\"number\">40</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"operator\">|</span>   <span class=\"number\">50</span>,<span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n<p>6、设置group_concat函数长度限制<br>临时设置法：<br>在命令行输入  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> session group_concat_max_len <span class=\"operator\">=</span> <span class=\"number\">18446744073709551615</span>;</span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"keyword\">global</span> max_allowed_packet <span class=\"operator\">=</span> <span class=\"number\">2</span> <span class=\"operator\">*</span> <span class=\"number\">1024</span> <span class=\"operator\">*</span> <span class=\"number\">1024</span> <span class=\"operator\">*</span> <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n<p>永久设置法：<br>在mysql配置文件中添加  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">max_allowed_packet <span class=\"operator\">=</span> <span class=\"number\">20</span>M</span><br><span class=\"line\">group_concat_max_len <span class=\"operator\">=</span> <span class=\"number\">18446744073709551615</span></span><br></pre></td></tr></table></figure>\n<p>重启mysql服务。  </p>\n<h3 id=\"2、concat-ws函数\"><a href=\"#2、concat-ws函数\" class=\"headerlink\" title=\"2、concat_ws函数\"></a>2、concat_ws函数</h3><p>可以用来将一列的值进行拼接，也可以实现多个字段的拼接。<br>1、有一张test表  </p>\n<figure class=\"highlight gherkin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|<span class=\"string\">   id   </span>|<span class=\"string\">   name   </span>|<span class=\"string\">   age   </span>|<span class=\"string\">   gender   </span>|</span><br><span class=\"line\">|<span class=\"string\">   1    </span>|<span class=\"string\">   Alice  </span>|<span class=\"string\">   25    </span>|<span class=\"string\">   female   </span>|</span><br><span class=\"line\">|<span class=\"string\">   2    </span>|<span class=\"string\">   Bob    </span>|<span class=\"string\">   30    </span>|<span class=\"string\">   male     </span>|</span><br><span class=\"line\">|<span class=\"string\">   3    </span>|<span class=\"string\">   Alice  </span>|<span class=\"string\">   25    </span>|<span class=\"string\">   female   </span>|</span><br><span class=\"line\">|<span class=\"string\">   4    </span>|<span class=\"string\">   Alice  </span>|<span class=\"string\">   30    </span>|<span class=\"string\">   female   </span>|</span><br></pre></td></tr></table></figure>\n<p>2、例子  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> concat_ws(<span class=\"string\">&#x27;,&#x27;</span>,name,age) <span class=\"keyword\">from</span> test <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> name,age;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">Alice,<span class=\"number\">25</span></span><br><span class=\"line\">Alice,<span class=\"number\">30</span></span><br><span class=\"line\">Bob,<span class=\"number\">30</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3、with-rollup\"><a href=\"#3、with-rollup\" class=\"headerlink\" title=\"3、with rollup\"></a>3、with rollup</h3><p>1、说明<br>可以实现在分组统计数据基础上再进行相同的统计。<br>2、例子<br>例如我们按名字进行分组，再统计每个人登录的次数：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> name,<span class=\"built_in\">sum</span>(sign_num) <span class=\"keyword\">as</span> sign_num <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> name <span class=\"keyword\">with</span> <span class=\"keyword\">rollup</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"operator\">|</span>   name   <span class=\"operator\">|</span>   sign_num   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小丽   <span class=\"operator\">|</span>          <span class=\"number\">2</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小明   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小王   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   <span class=\"keyword\">null</span>   <span class=\"operator\">|</span>          <span class=\"number\">16</span>   <span class=\"operator\">|</span></span><br></pre></td></tr></table></figure>\n<p>其中记录null表示所有人的登录次数，我们可以使用<code>coalesce</code>来设置一个可以取代null的名称，<code>coalesce</code>语法：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> coalescec(a,b,c);</span><br></pre></td></tr></table></figure>\n<p>参数说明：如果a&#x3D;&#x3D;null，则选择b；如果b&#x3D;&#x3D;null，则选择c；如果a!&#x3D;null，则选择a；如果a，b，c都为null，则返回null。<br>修改上面例子：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">coalesce</span>(name,<span class=\"string\">&#x27;总数&#x27;</span>),<span class=\"built_in\">sum</span>(sign_num) <span class=\"keyword\">as</span> sign_num <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> name <span class=\"keyword\">with</span> <span class=\"keyword\">rollup</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"operator\">|</span>   name   <span class=\"operator\">|</span>   sign_num   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小丽   <span class=\"operator\">|</span>          <span class=\"number\">2</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小明   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   小王   <span class=\"operator\">|</span>          <span class=\"number\">7</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   总数   <span class=\"operator\">|</span>         <span class=\"number\">16</span>   <span class=\"operator\">|</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"4、coalesce函数\"><a href=\"#4、coalesce函数\" class=\"headerlink\" title=\"4、coalesce函数\"></a>4、coalesce函数</h3><p><code>coalesce</code>函数接受多个参数，返回参数列表中的第一个非null值：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> name,<span class=\"built_in\">coalesce</span>(age, <span class=\"number\">0</span>) <span class=\"keyword\">as</span> age <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br></pre></td></tr></table></figure>\n<p>以上sql语句中，如果age为null，则coalesce函数返回0。  </p>\n<h3 id=\"5、ifnull函数\"><a href=\"#5、ifnull函数\" class=\"headerlink\" title=\"5、ifnull函数\"></a>5、ifnull函数</h3><p>是<code>coalesce</code>函数特定版本，它接受两个参数，如果第一个参数为null，则返回第二个参数。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> name,ifnull(age, <span class=\"number\">0</span>) <span class=\"keyword\">as</span> age <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"6、find-in-set函数\"><a href=\"#6、find-in-set函数\" class=\"headerlink\" title=\"6、find_in_set函数\"></a>6、find_in_set函数</h3><p>1、说明<br><code>find_in_set(str,strlist)</code>：查询表中的字段（strlist）中包含（str）的结果，返回结果为记录或null。<br>str：要查询的字符串；<br>strlist：表中的字段名，该字段值要是以<code>,</code>分隔的字符串。<br>2、例子1  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> find_in_set(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;a,b,c,d&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>结果为：2。<br>说明：strlist中下标从1开始，然后b在strlist中下标位置为第二个，所以返回2。<br>3、例子2  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> find_in_set(<span class=\"string\">&#x27;6&#x27;</span>,<span class=\"string\">&#x27;1,2&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>结果为：0。<br>说明：因为6不在strlist中，所以返回0。<br>4、例子3<br>sys_dept表为：  </p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">dept_id</span>  ancestors</span><br><span class=\"line\"><span class=\"attribute\">101</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"attribute\">201</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"attribute\">202</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span>,<span class=\"number\">201</span></span><br><span class=\"line\"><span class=\"attribute\">203</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span>,<span class=\"number\">201</span></span><br><span class=\"line\"><span class=\"attribute\">204</span>        <span class=\"number\">0</span>,<span class=\"number\">100</span>,<span class=\"number\">201</span></span><br></pre></td></tr></table></figure>\n<p>查询语句为：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> dept_id <span class=\"keyword\">from</span> sys_dept <span class=\"keyword\">where</span> find_in_set(<span class=\"string\">&#x27;201&#x27;</span>,ancestors);</span><br></pre></td></tr></table></figure>\n<p>结果为：  </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br></pre></td></tr></table></figure>\n<p>说明：从<code>sys_dept</code>表中查询，ancestors字段中含有201的数据，并只返回dept_id列，如果要查询201根目录和所有子目录数据，比如204，就是：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> dept_id <span class=\"keyword\">from</span> sys_dept <span class=\"keyword\">where</span> find_in_set(<span class=\"string\">&#x27;201&#x27;</span>,ancestors) <span class=\"keyword\">or</span> dept_id <span class=\"operator\">=</span> <span class=\"string\">&#x27;201&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>结果为：  </p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br></pre></td></tr></table></figure>\n<p>5、和<code>in</code>的区别<br>弄个测试表：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> `test` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">8</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> auto_increment,</span><br><span class=\"line\">  `name` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  `llist` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  <span class=\"keyword\">primary</span> key(`id`)</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> `test` <span class=\"keyword\">values</span> (<span class=\"number\">1</span>, <span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;daodao,xiaohe,xiaoqin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> `test` <span class=\"keyword\">values</span> (<span class=\"number\">2</span>, <span class=\"string\">&#x27;name2&#x27;</span>,<span class=\"string\">&#x27;daodao,xiaohe,xiaoqin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> `test` <span class=\"keyword\">values</span> (<span class=\"number\">3</span>, <span class=\"string\">&#x27;name3&#x27;</span>,<span class=\"string\">&#x27;daodao,xiaohe,xiaoqin&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>原来以为mysql可以这样查询：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">where</span> <span class=\"string\">&#x27;daodao&#x27;</span> <span class=\"keyword\">in</span> (list); </span><br></pre></td></tr></table></figure>\n<p>上面这样查是查不到的数据的，会为null；只有将list改为：’daodao’,’xiaohe’,’xiaoqin’才能查询到数据，因为list是变量，而’daodao’,’xiaohe’,’xiaoqin’是常量，所以只有改成下面这样才能查询到数据：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">where</span> <span class=\"string\">&#x27;daodao&#x27;</span> <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;daodao&#x27;</span>,<span class=\"string\">&#x27;xiaohe&#x27;</span>,<span class=\"string\">&#x27;xiaoqin&#x27;</span>); </span><br></pre></td></tr></table></figure>\n<p>或者使用<code>find_in_set()</code>：  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test <span class=\"keyword\">where</span> find_in_set(<span class=\"string\">&#x27;daodao&#x27;</span>,list); </span><br></pre></td></tr></table></figure>\n<p>总结：所以如果list是常量，则可以直接用<code>IN</code>， 否则要用<code>find_in_set()</code>函数。  </p>\n<h3 id=\"7、field函数\"><a href=\"#7、field函数\" class=\"headerlink\" title=\"7、field函数\"></a>7、field函数</h3><p>1、使用场景<br>在日常开发过程中，排序是经常用到的，有时候有这样的需求，需要在查询结果中根据某个字段的具体值来排序，比如：有张用户表，想按照‘seiki’、‘iris’来排序。<br>2、例子<br>（1）正序  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># field(str, str1, str2 ,str3.....)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> field(name,<span class=\"string\">&#x27;seiki&#x27;</span>,<span class=\"string\">&#x27;iris&#x27;</span>,<span class=\"string\">&#x27;xut&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\">id\t\tname\tage</span><br><span class=\"line\"># 这里还有很多记录，不在str1，str2，str3中的记录，然后会把这些记录放在前面</span><br><span class=\"line\"># 把在str1，str2，str3中的记录放在后面，str值相同的按照主键的顺序排列</span><br><span class=\"line\">......（前面还有很多记录，这里省略）</span><br><span class=\"line\"><span class=\"number\">3</span>\t\tseiki\t<span class=\"number\">33</span></span><br><span class=\"line\"><span class=\"number\">4</span>\t\tseiki\t<span class=\"number\">21</span></span><br><span class=\"line\"><span class=\"number\">1</span>\t\tiris\t<span class=\"number\">34</span></span><br><span class=\"line\"><span class=\"number\">2</span>\t\tiris\t<span class=\"number\">45</span></span><br><span class=\"line\"><span class=\"number\">6</span>\t\txut\t\t<span class=\"number\">12</span></span><br><span class=\"line\"><span class=\"number\">12</span>\t\txut\t\t<span class=\"number\">6</span></span><br></pre></td></tr></table></figure>\n<p>（2）倒叙  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> field(name,<span class=\"string\">&#x27;seiki&#x27;</span>,<span class=\"string\">&#x27;iris&#x27;</span>,<span class=\"string\">&#x27;xut&#x27;</span>) <span class=\"keyword\">desc</span>;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"8、char-length函数\"><a href=\"#8、char-length函数\" class=\"headerlink\" title=\"8、char_length函数\"></a>8、char_length函数</h3><p>char_length(str)：返回字符串str的字符数。  </p>\n<h3 id=\"9、concat-ws函数\"><a href=\"#9、concat-ws函数\" class=\"headerlink\" title=\"9、concat_ws函数\"></a>9、concat_ws函数</h3><p>concat_ws(s, s1, s2….sn)：将s1，s2……sn用s连起来。  </p>\n<h3 id=\"10、format函数\"><a href=\"#10、format函数\" class=\"headerlink\" title=\"10、format函数\"></a>10、format函数</h3><p>format(x, n)：将数字x按照“x,xxx.xx”格式返回，n为x保留的小数点位数，最后一位四舍五入。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> format(<span class=\"number\">250500.5634</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"number\">250</span>,<span class=\"number\">500.56</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"11、insert函数\"><a href=\"#11、insert函数\" class=\"headerlink\" title=\"11、insert函数\"></a>11、insert函数</h3><p>insert(str1, x, len, str2)：将str1第x位开始，长度为len的字符串替换为str2。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">insert</span>(<span class=\"string\">&#x27;google.com&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">6</span>, <span class=\"string\">&#x27;runoob&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出，将<span class=\"string\">&#x27;google.com&#x27;</span>从第<span class=\"number\">1</span>位开始，长度为<span class=\"number\">6</span>的字符串替换为<span class=\"string\">&#x27;runoob&#x27;</span></span><br><span class=\"line\">runoob.com</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"12、locate函数\"><a href=\"#12、locate函数\" class=\"headerlink\" title=\"12、locate函数\"></a>12、locate函数</h3><p>locate(str1, str2)：返回str2在str1中第一次出现的位置，如果str2不在str1中，则返回0。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> locate(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;abc&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出</span><br><span class=\"line\"><span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"13、lcase函数、lower函数\"><a href=\"#13、lcase函数、lower函数\" class=\"headerlink\" title=\"13、lcase函数、lower函数\"></a>13、lcase函数、lower函数</h3><p>lcase(str)：将字符串str中的字母全部转换为小写。<br>lower(str)：将字符串str中的字母全部转换为小写。  </p>\n<h3 id=\"14、left函数\"><a href=\"#14、left函数\" class=\"headerlink\" title=\"14、left函数\"></a>14、left函数</h3><p>left(str, len)：返回字符串str的前len个字符。  </p>\n<h3 id=\"15、ltrim函数\"><a href=\"#15、ltrim函数\" class=\"headerlink\" title=\"15、ltrim函数\"></a>15、ltrim函数</h3><p>ltrim(str)：删除字符串str左侧的空格。  </p>\n<h3 id=\"16、position函数\"><a href=\"#16、position函数\" class=\"headerlink\" title=\"16、position函数\"></a>16、position函数</h3><p>position(str1 in s)：从字符串s中获取str1的开始位置。  </p>\n<h3 id=\"17、repeat函数\"><a href=\"#17、repeat函数\" class=\"headerlink\" title=\"17、repeat函数\"></a>17、repeat函数</h3><p>repeat(str, n)：将字符串str重复n次。  </p>\n<h3 id=\"18、replace函数\"><a href=\"#18、replace函数\" class=\"headerlink\" title=\"18、replace函数\"></a>18、replace函数</h3><p>replace(s, s1, s2)：将s中的s1替换为s2。  </p>\n<h3 id=\"19、reverse函数\"><a href=\"#19、reverse函数\" class=\"headerlink\" title=\"19、reverse函数\"></a>19、reverse函数</h3><p>reverse(str)：将字符串str的顺序反过来。  </p>\n","categories":[{"name":"工作技能","path":"api/categories/工作技能.json"}],"tags":[{"name":"工作技能","path":"api/tags/工作技能.json"},{"name":"数据库","path":"api/tags/数据库.json"},{"name":"Mysql","path":"api/tags/Mysql.json"}]}