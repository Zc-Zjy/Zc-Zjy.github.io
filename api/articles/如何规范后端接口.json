{"title":"如何规范后端接口","slug":"如何规范后端接口","date":"2025-07-07T03:15:36.000Z","updated":"2025-07-07T06:33:26.877Z","comments":true,"path":"api/articles/如何规范后端接口.json","realPath":null,"excerpt":null,"covers":null,"cover":null,"content":"<p>1、新建一个枚举类，专门用来维护返回code和消息message：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">ResultCode</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String message;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">ResultCode</span><span class=\"params\">(Integer code, String message)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.message = message;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Integer <span class=\"title function_\">getCode</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String <span class=\"title function_\">getMessage</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.message;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 成功状态码</span></span><br><span class=\"line\">\tSUCCESS(<span class=\"number\">1</span>, <span class=\"string\">&quot;成功&quot;</span>),</span><br><span class=\"line\">\t<span class=\"comment\">// 参数错误：1001-1999</span></span><br><span class=\"line\">\tPARAM_IS_INVALID(<span class=\"number\">1001</span>, <span class=\"string\">&quot;参数无效&quot;</span>),</span><br><span class=\"line\">\tPARAM_IS_BLANK(<span class=\"number\">1002</span>, <span class=\"string\">&quot;参数为空&quot;</span>),</span><br><span class=\"line\">\tPARAM_TYPE_BIND_ERROR(<span class=\"number\">1003</span>, <span class=\"string\">&quot;参数类型错误&quot;</span>),</span><br><span class=\"line\">\tPARAM_NOT_COMPLETE(<span class=\"number\">1004</span>, <span class=\"string\">&quot;参数缺失&quot;</span>),</span><br><span class=\"line\">\t<span class=\"comment\">// 用户错误：2001-2999</span></span><br><span class=\"line\">\tUSER_NOT_LOGGED_IN(<span class=\"number\">2001</span>, <span class=\"string\">&quot;用户未登录，访问的路径需要验证，请登录&quot;</span>),</span><br><span class=\"line\">\tUSER_LOGIN_ERROR(<span class=\"number\">2002</span>, <span class=\"string\">&quot;账号不存在或密码错误&quot;</span>),</span><br><span class=\"line\">\tUSER_ACCOUNT_FORBIDDEN(<span class=\"number\">2003</span>, <span class=\"string\">&quot;账号已被禁用&quot;</span>),</span><br><span class=\"line\">\tUSER_NOT_EXIST(<span class=\"number\">2004</span>, <span class=\"string\">&quot;用户不存在&quot;</span>),</span><br><span class=\"line\">\tUSER_HAS_EXISTED(<span class=\"number\">2005</span>, <span class=\"string\">&quot;用户已存在&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2、新增一个结果返回类：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Result</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String message;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Object data;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">Result</span><span class=\"params\">(ResultCode resultCode, Object data)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.code = resultCode.getCode();</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.message = resultCode.getMessage();</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data = data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 返回成功</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">success</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Result</span>();</span><br><span class=\"line\">\t\tresult.setResultCode(ResultCode.SUCCESS);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">success</span><span class=\"params\">(Object data)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> Result.success();</span><br><span class=\"line\">\t\tresult.setData(data);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 返回失败</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">failure</span><span class=\"params\">(ResultCode resultCode)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Result</span>();</span><br><span class=\"line\">\t\tresult.setResultCode(resultCode);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">failure</span><span class=\"params\">(ResultCode resultCode, Object data)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> Result.failure(resultCode);</span><br><span class=\"line\">\t\tresult.setData(data);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>3、创建一个自定义注解，用来标注方法的返回值是否需要包装成返回类：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Retention(RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123; TYPE, METHOD &#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> ResponseResult &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>4、创建一个拦截器，拦截请求，判断请求是否被@ResponseResult注解标注：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ResponseResultInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">HandlerInterceptor</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 标记名称</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">RESPONSE_RESULT_ANN</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;RESPONSE-RESULT-ANN&quot;</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"keyword\">throws</span> Exception&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (handler <span class=\"keyword\">instanceof</span> HandlerMethod) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">final</span> <span class=\"type\">HandlerMethod</span> <span class=\"variable\">handlerMethod</span> <span class=\"operator\">=</span> (HandlerMethod) handler;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">final</span> Class&lt;?&gt; clazz = handlerMethod.getBeanType();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">final</span> <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> handlerMethod.getMethod();</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 判断是否在类对象上面加了注解</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (clazz.isAnnotationPresent(ResponseResult.class)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 设置此请求返回体，需要包装，往下传递，在ResponseBodyAdvice接口进行判断</span></span><br><span class=\"line\">\t\t\t\trequest.setAttribute(RESPONSE_RESULT_ANN, clazz.getAnnotation(ResponseResult.class));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.isAnnotationPresent(ResponseResult.class)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 判断方法体上是否有注解</span></span><br><span class=\"line\">\t\t\t\trequest.setAttribute(RESPONSE_RESULT_ANN, method.getAnnotation(ResponseResult.class));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此代码核心思想，就是获取此请求，是否需要返回值包装，设置一个属性标记。  </p>\n<p>5、创建一个类，实现接口ResponseBodyAdvice和@ControllerAdvice，判断是否需要包装返回值，如果需要，就把Controller接口的返回值进行重写：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ControllerAdvice</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ResponseResultHandler</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ResponseBodyAdvice</span>&lt;Object&gt; &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 标记名称</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">RESPONSE_RESULT_ANN</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;RESPONSE-RESULT-ANN&quot;</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">ServletRequestAttributes</span> <span class=\"variable\">sra</span> <span class=\"operator\">=</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes());</span><br><span class=\"line\">\t\t<span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> sra.getRequest();</span><br><span class=\"line\">\t\t<span class=\"comment\">// 判断请求，是否有标记</span></span><br><span class=\"line\">\t\t<span class=\"type\">ResponseResult</span> <span class=\"variable\">responseResultAnn</span> <span class=\"operator\">=</span> (ResponseResult) request.getAttribute(RESPONSE_RESULT_ANN);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> responseResultAnn == <span class=\"literal\">null</span> ? <span class=\"literal\">false</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Object <span class=\"title function_\">beforeBodyWrite</span><span class=\"params\">(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request, ServerHttpResponse response)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 重写返回体</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// 处理异常情况</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (body <span class=\"keyword\">instanceof</span> ErrorResult) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">ErrorResult</span> <span class=\"variable\">errorResult</span> <span class=\"operator\">=</span> (ErrorResult) body;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> Result.failure(errorResult.getCode(), errorResult.getMessage(), errorResult.getErrors());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 正常情况</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> Result.success(body);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>6、controller  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseResult</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderController</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> OrderService orderService;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Order <span class=\"title function_\">getOrder</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Order</span> <span class=\"variable\">order</span> <span class=\"operator\">=</span> orderService.getOrder(id);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> order;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","more":"<p>1、新建一个枚举类，专门用来维护返回code和消息message：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">ResultCode</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String message;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">ResultCode</span><span class=\"params\">(Integer code, String message)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.message = message;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Integer <span class=\"title function_\">getCode</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String <span class=\"title function_\">getMessage</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.message;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 成功状态码</span></span><br><span class=\"line\">\tSUCCESS(<span class=\"number\">1</span>, <span class=\"string\">&quot;成功&quot;</span>),</span><br><span class=\"line\">\t<span class=\"comment\">// 参数错误：1001-1999</span></span><br><span class=\"line\">\tPARAM_IS_INVALID(<span class=\"number\">1001</span>, <span class=\"string\">&quot;参数无效&quot;</span>),</span><br><span class=\"line\">\tPARAM_IS_BLANK(<span class=\"number\">1002</span>, <span class=\"string\">&quot;参数为空&quot;</span>),</span><br><span class=\"line\">\tPARAM_TYPE_BIND_ERROR(<span class=\"number\">1003</span>, <span class=\"string\">&quot;参数类型错误&quot;</span>),</span><br><span class=\"line\">\tPARAM_NOT_COMPLETE(<span class=\"number\">1004</span>, <span class=\"string\">&quot;参数缺失&quot;</span>),</span><br><span class=\"line\">\t<span class=\"comment\">// 用户错误：2001-2999</span></span><br><span class=\"line\">\tUSER_NOT_LOGGED_IN(<span class=\"number\">2001</span>, <span class=\"string\">&quot;用户未登录，访问的路径需要验证，请登录&quot;</span>),</span><br><span class=\"line\">\tUSER_LOGIN_ERROR(<span class=\"number\">2002</span>, <span class=\"string\">&quot;账号不存在或密码错误&quot;</span>),</span><br><span class=\"line\">\tUSER_ACCOUNT_FORBIDDEN(<span class=\"number\">2003</span>, <span class=\"string\">&quot;账号已被禁用&quot;</span>),</span><br><span class=\"line\">\tUSER_NOT_EXIST(<span class=\"number\">2004</span>, <span class=\"string\">&quot;用户不存在&quot;</span>),</span><br><span class=\"line\">\tUSER_HAS_EXISTED(<span class=\"number\">2005</span>, <span class=\"string\">&quot;用户已存在&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2、新增一个结果返回类：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Result</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String message;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Object data;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">Result</span><span class=\"params\">(ResultCode resultCode, Object data)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.code = resultCode.getCode();</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.message = resultCode.getMessage();</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data = data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 返回成功</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">success</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Result</span>();</span><br><span class=\"line\">\t\tresult.setResultCode(ResultCode.SUCCESS);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">success</span><span class=\"params\">(Object data)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> Result.success();</span><br><span class=\"line\">\t\tresult.setData(data);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 返回失败</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">failure</span><span class=\"params\">(ResultCode resultCode)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Result</span>();</span><br><span class=\"line\">\t\tresult.setResultCode(resultCode);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Result <span class=\"title function_\">failure</span><span class=\"params\">(ResultCode resultCode, Object data)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Result</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> Result.failure(resultCode);</span><br><span class=\"line\">\t\tresult.setData(data);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> result;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>3、创建一个自定义注解，用来标注方法的返回值是否需要包装成返回类：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Retention(RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123; TYPE, METHOD &#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> ResponseResult &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>4、创建一个拦截器，拦截请求，判断请求是否被@ResponseResult注解标注：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ResponseResultInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">HandlerInterceptor</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 标记名称</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">RESPONSE_RESULT_ANN</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;RESPONSE-RESULT-ANN&quot;</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"keyword\">throws</span> Exception&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (handler <span class=\"keyword\">instanceof</span> HandlerMethod) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">final</span> <span class=\"type\">HandlerMethod</span> <span class=\"variable\">handlerMethod</span> <span class=\"operator\">=</span> (HandlerMethod) handler;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">final</span> Class&lt;?&gt; clazz = handlerMethod.getBeanType();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">final</span> <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> handlerMethod.getMethod();</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 判断是否在类对象上面加了注解</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (clazz.isAnnotationPresent(ResponseResult.class)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 设置此请求返回体，需要包装，往下传递，在ResponseBodyAdvice接口进行判断</span></span><br><span class=\"line\">\t\t\t\trequest.setAttribute(RESPONSE_RESULT_ANN, clazz.getAnnotation(ResponseResult.class));</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.isAnnotationPresent(ResponseResult.class)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 判断方法体上是否有注解</span></span><br><span class=\"line\">\t\t\t\trequest.setAttribute(RESPONSE_RESULT_ANN, method.getAnnotation(ResponseResult.class));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此代码核心思想，就是获取此请求，是否需要返回值包装，设置一个属性标记。  </p>\n<p>5、创建一个类，实现接口ResponseBodyAdvice和@ControllerAdvice，判断是否需要包装返回值，如果需要，就把Controller接口的返回值进行重写：  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ControllerAdvice</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ResponseResultHandler</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ResponseBodyAdvice</span>&lt;Object&gt; &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 标记名称</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">RESPONSE_RESULT_ANN</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;RESPONSE-RESULT-ANN&quot;</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">ServletRequestAttributes</span> <span class=\"variable\">sra</span> <span class=\"operator\">=</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes());</span><br><span class=\"line\">\t\t<span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> sra.getRequest();</span><br><span class=\"line\">\t\t<span class=\"comment\">// 判断请求，是否有标记</span></span><br><span class=\"line\">\t\t<span class=\"type\">ResponseResult</span> <span class=\"variable\">responseResultAnn</span> <span class=\"operator\">=</span> (ResponseResult) request.getAttribute(RESPONSE_RESULT_ANN);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> responseResultAnn == <span class=\"literal\">null</span> ? <span class=\"literal\">false</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Object <span class=\"title function_\">beforeBodyWrite</span><span class=\"params\">(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request, ServerHttpResponse response)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 重写返回体</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// 处理异常情况</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (body <span class=\"keyword\">instanceof</span> ErrorResult) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">ErrorResult</span> <span class=\"variable\">errorResult</span> <span class=\"operator\">=</span> (ErrorResult) body;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> Result.failure(errorResult.getCode(), errorResult.getMessage(), errorResult.getErrors());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 正常情况</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> Result.success(body);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>6、controller  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseResult</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OrderController</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> OrderService orderService;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Order <span class=\"title function_\">getOrder</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Order</span> <span class=\"variable\">order</span> <span class=\"operator\">=</span> orderService.getOrder(id);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> order;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"工作技能","path":"api/categories/工作技能.json"}],"tags":[{"name":"工作技能","path":"api/tags/工作技能.json"},{"name":"后端","path":"api/tags/后端.json"},{"name":"Java","path":"api/tags/Java.json"}]}